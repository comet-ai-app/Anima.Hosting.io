<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - AnimeStream</title>
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-storage-compat.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .admin-container {
            display: flex;
            min-height: 100vh;
        }
        
        /* Login Screen */
        .login-screen {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
        }
        
        .login-form {
            background: rgba(255, 255, 255, 0.95);
            padding: 40px;
            border-radius: 20px;
            width: 90%;
            max-width: 450px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .login-form h2 {
            text-align: center;
            margin-bottom: 30px;
            color: #333;
            font-size: 28px;
            font-weight: 600;
        }
        
        .login-logo {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .login-logo img {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 15px;
            margin-bottom: 15px;
        }
        
        .login-logo h1 {
            color: #333;
            font-size: 24px;
            font-weight: 600;
        }
        
        .login-logo p {
            color: #666;
            font-size: 14px;
            margin-top: 5px;
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 500;
            font-size: 14px;
        }
        
        .form-control {
            width: 100%;
            padding: 14px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 16px;
            transition: all 0.3s;
            background: #f8f9fa;
        }
        
        .form-control:focus {
            outline: none;
            border-color: #667eea;
            background: white;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .password-container {
            position: relative;
        }
        
        .toggle-password {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: #666;
            cursor: pointer;
            font-size: 18px;
        }
        
        .btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }
        
        .login-footer {
            text-align: center;
            margin-top: 25px;
            color: #666;
            font-size: 14px;
        }
        
        /* Sidebar */
        .sidebar {
            width: 280px;
            background: linear-gradient(180deg, #1a1a2e 0%, #16213e 100%);
            color: white;
            padding: 0;
            box-shadow: 5px 0 15px rgba(0, 0, 0, 0.2);
            position: fixed;
            height: 100vh;
            overflow-y: auto;
        }
        
        .logo {
            padding: 30px 25px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            text-align: center;
        }
        
        .logo h1 {
            color: #fff;
            font-size: 24px;
            font-weight: 700;
            letter-spacing: 1px;
        }
        
        .logo p {
            color: #a0a0c0;
            font-size: 12px;
            margin-top: 5px;
            letter-spacing: 0.5px;
        }
        
        .user-profile {
            padding: 25px;
            text-align: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .profile-pic {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid #667eea;
            margin-bottom: 15px;
        }
        
        .user-profile h3 {
            color: white;
            font-size: 18px;
            margin-bottom: 5px;
        }
        
        .user-profile p {
            color: #a0a0c0;
            font-size: 14px;
        }
        
        .admin-badge {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-top: 10px;
        }
        
        .sidebar-menu {
            list-style: none;
            padding: 20px 0;
        }
        
        .menu-item {
            padding: 18px 25px;
            cursor: pointer;
            display: flex;
            align-items: center;
            transition: all 0.3s;
            border-left: 4px solid transparent;
            margin: 5px 0;
        }
        
        .menu-item:hover {
            background: rgba(102, 126, 234, 0.1);
            border-left-color: #667eea;
        }
        
        .menu-item.active {
            background: rgba(102, 126, 234, 0.2);
            border-left-color: #667eea;
        }
        
        .menu-item i {
            margin-right: 15px;
            font-size: 20px;
            width: 24px;
            text-align: center;
        }
        
        .menu-text {
            font-size: 16px;
            font-weight: 500;
        }
        
        .menu-badge {
            margin-left: auto;
            background: #667eea;
            color: white;
            padding: 4px 8px;
            border-radius: 10px;
            font-size: 12px;
            font-weight: 600;
        }
        
        /* Main Content */
        .main-content {
            flex: 1;
            padding: 0;
            margin-left: 280px;
            background: #f5f7fb;
            min-height: 100vh;
        }
        
        .header {
            background: white;
            padding: 25px 30px;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }
        
        .header h1 {
            color: #333;
            font-size: 28px;
            font-weight: 600;
        }
        
        .header p {
            color: #666;
            margin-top: 5px;
            font-size: 16px;
        }
        
        .header-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .notification-btn {
            background: none;
            border: none;
            font-size: 20px;
            color: #666;
            cursor: pointer;
            position: relative;
            padding: 10px;
        }
        
        .notification-badge {
            position: absolute;
            top: 0;
            right: 0;
            background: #ff4757;
            color: white;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            font-size: 11px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .logout-btn {
            background: linear-gradient(135deg, #ff6b6b 0%, #ff4757 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }
        
        .logout-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.3);
        }
        
        /* Dashboard Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 25px;
            padding: 30px;
        }
        
        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.05);
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
        }
        
        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
        }
        
        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .stat-trend {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 14px;
            font-weight: 600;
            padding: 5px 10px;
            border-radius: 20px;
        }
        
        .trend-up {
            background: rgba(46, 204, 113, 0.1);
            color: #2ecc71;
        }
        
        .trend-down {
            background: rgba(255, 71, 87, 0.1);
            color: #ff4757;
        }
        
        .stat-value {
            font-size: 32px;
            font-weight: 700;
            color: #333;
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: #666;
            font-size: 14px;
            font-weight: 500;
        }
        
        .stat-change {
            font-size: 12px;
            margin-left: 5px;
        }
        
        /* Form Container */
        .form-container {
            background: white;
            padding: 35px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.05);
            margin: 30px;
        }
        
        .section-title {
            color: #333;
            font-size: 22px;
            font-weight: 600;
            margin-bottom: 10px;
        }
        
        .section-subtitle {
            color: #666;
            font-size: 16px;
            margin-bottom: 30px;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
        }
        
        textarea.form-control {
            min-height: 120px;
            resize: vertical;
            font-family: inherit;
        }
        
        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 15px;
            margin-top: 30px;
            padding-top: 30px;
            border-top: 1px solid #eee;
        }
        
        .btn-secondary {
            background: #6c757d;
            border: none;
            padding: 14px 30px;
            border-radius: 10px;
            color: white;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .btn-secondary:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }
        
        /* File Upload */
        .file-upload {
            border: 2px dashed #d1d5db;
            padding: 40px;
            text-align: center;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            background: #f8f9fa;
        }
        
        .file-upload:hover {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.05);
        }
        
        .file-upload i {
            font-size: 48px;
            color: #667eea;
            margin-bottom: 15px;
        }
        
        .file-upload p {
            color: #666;
            margin-bottom: 10px;
            font-size: 16px;
        }
        
        .file-upload span {
            color: #667eea;
            font-size: 14px;
            font-weight: 600;
        }
        
        .file-preview {
            margin-top: 20px;
        }
        
        .preview-image {
            max-width: 100%;
            max-height: 200px;
            object-fit: contain;
            border-radius: 10px;
            border: 1px solid #e0e0e0;
            padding: 5px;
            background: white;
        }
        
        /* Table Styles */
        .table-container {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.05);
            margin: 30px;
            overflow-x: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th {
            background: #f8f9fa;
            padding: 18px 15px;
            text-align: left;
            color: #333;
            font-weight: 600;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-bottom: 2px solid #e0e0e0;
        }
        
        td {
            padding: 18px 15px;
            border-bottom: 1px solid #eee;
            color: #555;
            font-size: 14px;
        }
        
        tr:hover {
            background: #f8f9fa;
        }
        
        .status-badge {
            display: inline-block;
            padding: 6px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .status-active {
            background: rgba(46, 204, 113, 0.1);
            color: #2ecc71;
        }
        
        .status-inactive {
            background: rgba(255, 71, 87, 0.1);
            color: #ff4757;
        }
        
        .status-pending {
            background: rgba(255, 193, 7, 0.1);
            color: #ffc107;
        }
        
        .action-buttons {
            display: flex;
            gap: 8px;
        }
        
        .action-btn {
            padding: 8px 15px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: all 0.3s;
        }
        
        .action-btn:hover {
            transform: translateY(-2px);
        }
        
        .btn-view {
            background: rgba(52, 152, 219, 0.1);
            color: #3498db;
        }
        
        .btn-edit {
            background: rgba(46, 204, 113, 0.1);
            color: #2ecc71;
        }
        
        .btn-delete {
            background: rgba(255, 71, 87, 0.1);
            color: #ff4757;
        }
        
        .btn-block {
            background: rgba(255, 193, 7, 0.1);
            color: #ffc107;
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            backdrop-filter: blur(5px);
        }
        
        .modal-content {
            background: white;
            width: 90%;
            max-width: 600px;
            margin: 50px auto;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: modalSlide 0.3s ease;
        }
        
        @keyframes modalSlide {
            from { opacity: 0; transform: translateY(-50px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
        }
        
        .modal-header h2 {
            color: #333;
            font-size: 24px;
            font-weight: 600;
        }
        
        .close-modal {
            font-size: 28px;
            cursor: pointer;
            color: #666;
            transition: color 0.3s;
        }
        
        .close-modal:hover {
            color: #ff4757;
        }
        
        /* Tabs */
        .tab-container {
            margin-bottom: 30px;
        }
        
        .tabs {
            display: flex;
            border-bottom: 2px solid #e0e0e0;
            margin-bottom: 30px;
        }
        
        .tab {
            padding: 15px 30px;
            cursor: pointer;
            color: #666;
            font-weight: 500;
            font-size: 16px;
            transition: all 0.3s;
            position: relative;
        }
        
        .tab:hover {
            color: #667eea;
        }
        
        .tab.active {
            color: #667eea;
            font-weight: 600;
        }
        
        .tab.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 100%;
            height: 2px;
            background: #667eea;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Season/Episode Management */
        .season-episode-container {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 25px;
            border: 1px solid #e0e0e0;
        }
        
        .season-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .season-header h3 {
            color: #333;
            font-size: 18px;
            font-weight: 600;
        }
        
        .episode-item {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            border: 1px solid #e0e0e0;
            transition: all 0.3s;
        }
        
        .episode-item:hover {
            border-color: #667eea;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        
        .episode-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .add-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }
        
        .add-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }
        
        .remove-btn {
            background: #ff4757;
            color: white;
            padding: 8px 15px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
        }
        
        /* Recent Activity */
        .activity-container {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.05);
            margin: 30px;
        }
        
        .activity-list {
            margin-top: 20px;
        }
        
        .activity-item {
            display: flex;
            align-items: flex-start;
            padding: 20px 0;
            border-bottom: 1px solid #eee;
        }
        
        .activity-item:last-child {
            border-bottom: none;
        }
        
        .activity-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: white;
            margin-right: 15px;
            flex-shrink: 0;
        }
        
        .activity-content h4 {
            color: #333;
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .activity-content p {
            color: #666;
            font-size: 14px;
            margin-bottom: 5px;
        }
        
        .activity-time {
            color: #999;
            font-size: 12px;
        }
        
        /* Responsive */
        @media (max-width: 1024px) {
            .sidebar {
                width: 250px;
            }
            
            .main-content {
                margin-left: 250px;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 768px) {
            .sidebar {
                display: none;
            }
            
            .main-content {
                margin-left: 0;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .header-right {
                width: 100%;
                justify-content: center;
            }
        }
        
        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(102, 126, 234, 0.3);
            border-radius: 50%;
            border-top-color: #667eea;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div class="login-screen" id="loginScreen">
        <div class="login-form">
            <div class="login-logo">
                <div style="width: 80px; height: 80px; border-radius: 50%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; margin: 0 auto 15px;">
                    <span style="color: white; font-size: 32px;">üé¨</span>
                </div>
                <h1>AnimeStream Admin</h1>
                <p>Professional Anime Management System</p>
            </div>
            
            <div class="form-group">
                <label for="adminEmail">Admin Email</label>
                <input type="email" id="adminEmail" class="form-control" placeholder="rudradevmanhar820@gmail.com" value="rudradevmanhar820@gmail.com">
            </div>
            
            <div class="form-group">
                <label for="adminPassword">Password</label>
                <div class="password-container">
                    <input type="password" id="adminPassword" class="form-control" placeholder="Enter your password" value="rudra@#_/071989">
                    <button type="button" class="toggle-password" onclick="togglePassword()">üëÅÔ∏è</button>
                </div>
            </div>
            
            <button class="btn" onclick="adminLogin()">
                <span id="loginText">Login to Dashboard</span>
                <span id="loginLoading" style="display: none;" class="loading"></span>
            </button>
            
            <div class="login-footer">
                <p>¬© 2024 AnimeStream. All rights reserved.</p>
                <p style="margin-top: 5px; font-size: 12px; color: #999;">Secure Admin Access Only</p>
            </div>
        </div>
    </div>

    <!-- Admin Panel -->
    <div class="admin-container" id="adminPanel" style="display: none;">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="logo">
                <h1>üé¨ AnimeStream</h1>
                <p>Admin Dashboard</p>
            </div>
            
            <div class="user-profile">
                <img src="https://ui-avatars.com/api/?name=Rudra+Dev&background=667eea&color=fff&size=128" class="profile-pic" id="adminProfilePic">
                <h3 id="adminName">Rudra Dev</h3>
                <p id="adminEmailDisplay">rudradevmanhar820@gmail.com</p>
                <div class="admin-badge">Super Admin</div>
            </div>
            
            <ul class="sidebar-menu">
                <li class="menu-item active" onclick="switchTab('dashboard')">
                    <span>üìä</span>
                    <span class="menu-text">Dashboard</span>
                    <span class="menu-badge" id="dashboardBadge">3</span>
                </li>
                <li class="menu-item" onclick="switchTab('uploadAnime')">
                    <span>üì§</span>
                    <span class="menu-text">Upload Anime</span>
                </li>
                <li class="menu-item" onclick="switchTab('manageAnime')">
                    <span>üé¨</span>
                    <span class="menu-text">Manage Anime</span>
                    <span class="menu-badge" id="animeBadge">0</span>
                </li>
                <li class="menu-item" onclick="switchTab('manageUsers')">
                    <span>üë•</span>
                    <span class="menu-text">Manage Users</span>
                    <span class="menu-badge" id="usersBadge">0</span>
                </li>
                <li class="menu-item" onclick="switchTab('appSettings')">
                    <span>‚öôÔ∏è</span>
                    <span class="menu-text">App Settings</span>
                </li>
                <li class="menu-item" onclick="switchTab('reports')">
                    <span>üìà</span>
                    <span class="menu-text">Reports & Analytics</span>
                </li>
                <li class="menu-item" onclick="switchTab('backup')">
                    <span>üíæ</span>
                    <span class="menu-text">Backup & Restore</span>
                </li>
                <li class="menu-item" onclick="logout()" style="margin-top: 30px; background: rgba(255, 71, 87, 0.1);">
                    <span>üö™</span>
                    <span class="menu-text">Logout</span>
                </li>
            </ul>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Header -->
            <div class="header">
                <div>
                    <h1 id="pageTitle">Dashboard Overview</h1>
                    <p id="pageSubtitle">Welcome back, Rudra! Here's what's happening with your app.</p>
                </div>
                
                <div class="header-right">
                    <button class="notification-btn">
                        üîî
                        <span class="notification-badge" id="notificationCount">5</span>
                    </button>
                    <button class="logout-btn" onclick="logout()">
                        <span>üö™</span> Logout
                    </button>
                </div>
            </div>

            <!-- Dashboard Tab -->
            <div id="dashboardTab" class="tab-content active">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon">üë•</div>
                            <div class="stat-trend trend-up">‚Üë 12%</div>
                        </div>
                        <div class="stat-value" id="totalUsers">0</div>
                        <div class="stat-label">Total Users</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon">üé¨</div>
                            <div class="stat-trend trend-up">‚Üë 8%</div>
                        </div>
                        <div class="stat-value" id="totalAnime">0</div>
                        <div class="stat-label">Total Anime</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon">üëÅÔ∏è</div>
                            <div class="stat-trend trend-up">‚Üë 23%</div>
                        </div>
                        <div class="stat-value" id="totalViews">0</div>
                        <div class="stat-label">Total Views</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon">üìä</div>
                            <div class="stat-trend trend-up">‚Üë 5%</div>
                        </div>
                        <div class="stat-value" id="activeUsers">0</div>
                        <div class="stat-label">Active Today</div>
                    </div>
                </div>
                
                <div class="form-container">
                    <h2 class="section-title">Quick Actions</h2>
                    <p class="section-subtitle">Perform common admin tasks quickly</p>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <button class="btn" onclick="switchTab('uploadAnime')">
                            <span style="font-size: 20px; margin-right: 10px;">üì§</span>
                            Upload New Anime
                        </button>
                        <button class="btn-secondary" onclick="switchTab('manageUsers')">
                            <span style="font-size: 20px; margin-right: 10px;">üë•</span>
                            Manage Users
                        </button>
                        <button class="btn-secondary" onclick="switchTab('appSettings')">
                            <span style="font-size: 20px; margin-right: 10px;">‚öôÔ∏è</span>
                            App Settings
                        </button>
                        <button class="btn-secondary" onclick="switchTab('reports')">
                            <span style="font-size: 20px; margin-right: 10px;">üìà</span>
                            View Reports
                        </button>
                    </div>
                </div>
                
                <div class="activity-container">
                    <h2 class="section-title">Recent Activity</h2>
                    <p class="section-subtitle">Latest actions from your admin panel</p>
                    
                    <div class="activity-list" id="activityList">
                        <!-- Activity items will be loaded here -->
                        <div class="activity-item">
                            <div class="activity-icon" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">üì§</div>
                            <div class="activity-content">
                                <h4>New Anime Uploaded</h4>
                                <p>"Demon Slayer: Kimetsu no Yaiba" added to library</p>
                                <div class="activity-time">2 minutes ago</div>
                            </div>
                        </div>
                        
                        <div class="activity-item">
                            <div class="activity-icon" style="background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);">‚úÖ</div>
                            <div class="activity-content">
                                <h4>User Registered</h4>
                                <p>New user "AnimeFan123" joined the platform</p>
                                <div class="activity-time">15 minutes ago</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Upload Anime Tab -->
            <div id="uploadAnimeTab" class="tab-content" style="display: none;">
                <div class="form-container">
                    <h2 class="section-title">Upload New Anime</h2>
                    <p class="section-subtitle">Add new anime content to your streaming platform</p>
                    
                    <div class="tab-container">
                        <div class="tabs">
                            <div class="tab active" onclick="switchAnimeTab('basic')">Basic Info</div>
                            <div class="tab" onclick="switchAnimeTab('seasons')">Seasons & Episodes</div>
                            <div class="tab" onclick="switchAnimeTab('media')">Media Files</div>
                        </div>
                    </div>
                    
                    <!-- Basic Info Tab -->
                    <div id="basicInfoTab" class="anime-tab-content active">
                        <div class="form-group">
                            <label>Anime Title *</label>
                            <input type="text" id="animeTitle" class="form-control" placeholder="Enter anime title (e.g., Demon Slayer: Kimetsu no Yaiba)">
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label>Category *</label>
                                <select id="animeCategory" class="form-control">
                                    <option value="action">Action</option>
                                    <option value="adventure">Adventure</option>
                                    <option value="comedy">Comedy</option>
                                    <option value="drama">Drama</option>
                                    <option value="fantasy">Fantasy</option>
                                    <option value="horror">Horror</option>
                                    <option value="romance">Romance</option>
                                    <option value="sci-fi">Sci-Fi</option>
                                    <option value="shounen">Shounen</option>
                                    <option value="shoujo">Shoujo</option>
                                    <option value="seinen">Seinen</option>
                                    <option value="josei">Josei</option>
                                    <option value="isekai">Isekai</option>
                                    <option value="mecha">Mecha</option>
                                    <option value="sports">Sports</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label>Status</label>
                                <select id="animeStatus" class="form-control">
                                    <option value="ongoing">Ongoing</option>
                                    <option value="completed">Completed</option>
                                    <option value="upcoming">Upcoming</option>
                                    <option value="hiatus">Hiatus</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>Description *</label>
                            <textarea id="animeDescription" class="form-control" 
                                      placeholder="Enter detailed description of the anime..."></textarea>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label>Release Year</label>
                                <input type="number" id="releaseYear" class="form-control" 
                                       min="1900" max="2024" value="2024">
                            </div>
                            
                            <div class="form-group">
                                <label>Total Seasons (1-100)</label>
                                <input type="number" id="totalSeasons" class="form-control" 
                                       min="1" max="100" value="1" onchange="generateSeasons()">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label>Rating (1-10)</label>
                                <input type="number" id="animeRating" class="form-control" 
                                       min="1" max="10" step="0.1" value="8.5">
                            </div>
                            
                            <div class="form-group">
                                <label>Studio</label>
                                <input type="text" id="animeStudio" class="form-control" 
                                       placeholder="Studio name (e.g., Ufotable)">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>Additional Options</label>
                            <div style="display: flex; flex-wrap: wrap; gap: 20px; margin-top: 10px;">
                                <div>
                                    <input type="checkbox" id="isSimulcast" style="margin-right: 10px;">
                                    <label for="isSimulcast">Simulcast Anime</label>
                                </div>
                                <div>
                                    <input type="checkbox" id="isDubAvailable" style="margin-right: 10px;">
                                    <label for="isDubAvailable">Dub Available</label>
                                </div>
                                <div>
                                    <input type="checkbox" id="isFeatured" style="margin-right: 10px;">
                                    <label for="isFeatured">Featured Anime</label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-actions">
                            <button class="btn-secondary" onclick="switchAnimeTab('seasons')">
                                ‚Üê Back
                            </button>
                            <button class="btn" onclick="switchAnimeTab('seasons')">
                                Next: Seasons & Episodes ‚Üí
                            </button>
                        </div>
                    </div>
                    
                    <!-- Seasons Tab -->
                    <div id="seasonsTab" class="anime-tab-content" style="display: none;">
                        <div id="seasonsContainer">
                            <!-- Seasons will be generated here -->
                        </div>
                        
                        <div class="form-actions">
                            <button class="btn-secondary" onclick="switchAnimeTab('basic')">
                                ‚Üê Back to Basic Info
                            </button>
                            <button class="btn" onclick="switchAnimeTab('media')">
                                Next: Media Files ‚Üí
                            </button>
                        </div>
                    </div>
                    
                    <!-- Media Tab -->
                    <div id="mediaTab" class="anime-tab-content" style="display: none;">
                        <div class="form-group">
                            <label>Thumbnail Image * (300x400px recommended)</label>
                            <div class="file-upload" onclick="document.getElementById('thumbnailInput').click()">
                                <div>üì∑</div>
                                <p>Click to upload thumbnail image</p>
                                <span>PNG, JPG, or WebP ‚Ä¢ Max 5MB</span>
                                <div class="file-preview" id="thumbnailPreview"></div>
                            </div>
                            <input type="file" id="thumbnailInput" accept="image/*" style="display: none;">
                        </div>
                        
                        <div class="form-group">
                            <label>Banner Image * (1200x400px recommended)</label>
                            <div class="file-upload" onclick="document.getElementById('bannerInput').click()">
                                <div>üñºÔ∏è</div>
                                <p>Click to upload banner image</p>
                                <span>PNG, JPG, or WebP ‚Ä¢ Max 10MB</span>
                                <div class="file-preview" id="bannerPreview"></div>
                            </div>
                            <input type="file" id="bannerInput" accept="image/*" style="display: none;">
                        </div>
                        
                        <div class="form-group">
                            <label>Episode Videos</label>
                            <p style="color: #666; margin-bottom: 15px; font-size: 14px;">
                                Upload videos for each episode. Videos will be automatically assigned to the corresponding episode numbers.
                            </p>
                            <div id="episodeUploads">
                                <!-- Episode upload fields will be added here -->
                            </div>
                        </div>
                        
                        <div class="form-actions">
                            <button class="btn-secondary" onclick="switchAnimeTab('seasons')">
                                ‚Üê Back to Seasons
                            </button>
                            <button class="btn" onclick="uploadAnime()" id="uploadAnimeBtn">
                                <span>üöÄ Upload Anime</span>
                                <span id="uploadLoading" style="display: none;" class="loading"></span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Manage Anime Tab -->
            <div id="manageAnimeTab" class="tab-content" style="display: none;">
                <div class="form-container">
                    <h2 class="section-title">Manage Anime</h2>
                    <p class="section-subtitle">Edit or delete anime content from your library</p>
                    
                    <div style="display: flex; gap: 15px; margin-bottom: 25px;">
                        <input type="text" class="form-control" placeholder="Search anime..." id="searchAnime" style="flex: 1;">
                        <select class="form-control" id="filterCategory" style="width: 200px;">
                            <option value="">All Categories</option>
                            <option value="action">Action</option>
                            <option value="adventure">Adventure</option>
                            <option value="comedy">Comedy</option>
                            <option value="drama">Drama</option>
                        </select>
                        <button class="btn" onclick="loadAnimeTable()">üîç Search</button>
                    </div>
                </div>
                
                <div class="table-container">
                    <table id="animeTable">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Thumbnail</th>
                                <th>Title</th>
                                <th>Category</th>
                                <th>Seasons</th>
                                <th>Episodes</th>
                                <th>Views</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="animeTableBody">
                            <!-- Anime rows will be loaded here -->
                        </tbody>
                    </table>
                    
                    <div style="text-align: center; margin-top: 30px; color: #666; font-size: 14px;" id="animeTableEmpty">
                        No anime found. Start by uploading your first anime!
                    </div>
                </div>
            </div>

            <!-- Manage Users Tab -->
            <div id="manageUsersTab" class="tab-content" style="display: none;">
                <div class="form-container">
                    <h2 class="section-title">Manage Users</h2>
                    <p class="section-subtitle">View, block, or unblock users on your platform</p>
                    
                    <div style="display: flex; gap: 15px; margin-bottom: 25px;">
                        <input type="text" class="form-control" placeholder="Search users..." id="searchUsers" style="flex: 1;">
                        <select class="form-control" id="filterStatus" style="width: 200px;">
                            <option value="">All Status</option>
                            <option value="active">Active</option>
                            <option value="blocked">Blocked</option>
                        </select>
                        <button class="btn" onclick="loadUsersTable()">üîç Search</button>
                    </div>
                </div>
                
                <div class="table-container">
                    <table id="usersTable">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Avatar</th>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Joined</th>
                                <th>Anime Watched</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="usersTableBody">
                            <!-- User rows will be loaded here -->
                        </tbody>
                    </table>
                    
                    <div style="text-align: center; margin-top: 30px; color: #666; font-size: 14px;" id="usersTableEmpty">
                        No users found.
                    </div>
                </div>
            </div>

            <!-- App Settings Tab -->
            <div id="appSettingsTab" class="tab-content" style="display: none;">
                <div class="form-container">
                    <h2 class="section-title">App Settings</h2>
                    <p class="section-subtitle">Configure your anime streaming platform settings</p>
                    
                    <div class="form-group">
                        <label>App Name</label>
                        <input type="text" id="appName" class="form-control" value="AnimeStream Pro">
                    </div>
                    
                    <div class="form-group">
                        <label>App Logo</label>
                        <div class="file-upload" onclick="document.getElementById('logoInput').click()">
                            <div>üè∑Ô∏è</div>
                            <p>Click to upload app logo</p>
                            <span>PNG or SVG ‚Ä¢ Max 2MB</span>
                            <div class="file-preview" id="logoPreview"></div>
                        </div>
                        <input type="file" id="logoInput" accept="image/*" style="display: none;">
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Admob Publisher ID</label>
                            <input type="text" id="admobId" class="form-control" 
                                   value="ca-pub-8675548946096450">
                        </div>
                        
                        <div class="form-group">
                            <label>Ads per Episode (1-10)</label>
                            <input type="number" id="adsPerEpisode" class="form-control" 
                                   min="1" max="10" value="3">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Welcome Message</label>
                        <textarea id="welcomeMessage" class="form-control" rows="4">
Welcome to AnimeStream Pro! Enjoy unlimited anime streaming for free. Watch your favorite anime anytime, anywhere without any premium subscriptions.
                        </textarea>
                    </div>
                    
                    <div class="form-group">
                        <label>Contact Email</label>
                        <input type="email" id="contactEmail" class="form-control" 
                               value="support@animestream.com">
                    </div>
                    
                    <div class="form-group">
                        <label>Privacy Policy URL</label>
                        <input type="url" id="privacyPolicy" class="form-control" 
                               value="https://animestream.com/privacy">
                    </div>
                    
                    <div class="form-group">
                        <label>Terms of Service URL</label>
                        <input type="url" id="termsOfService" class="form-control" 
                               value="https://animestream.com/terms">
                    </div>
                    
                    <div class="form-actions">
                        <button class="btn-secondary" onclick="loadSettings()">
                            Reset Changes
                        </button>
                        <button class="btn" onclick="saveSettings()">
                            üíæ Save Settings
                        </button>
                    </div>
                </div>
            </div>

            <!-- Reports Tab -->
            <div id="reportsTab" class="tab-content" style="display: none;">
                <div class="form-container">
                    <h2 class="section-title">Reports & Analytics</h2>
                    <p class="section-subtitle">Detailed insights about your platform performance</p>
                    
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-header">
                                <div class="stat-icon">üìà</div>
                            </div>
                            <div class="stat-value" id="dailyViews">0</div>
                            <div class="stat-label">Daily Views</div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-header">
                                <div class="stat-icon">üí∞</div>
                            </div>
                            <div class="stat-value" id="estimatedRevenue">$0</div>
                            <div class="stat-label">Estimated Revenue</div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-header">
                                <div class="stat-icon">‚è±Ô∏è</div>
                            </div>
                            <div class="stat-value" id="avgWatchTime">0h</div>
                            <div class="stat-label">Avg. Watch Time</div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-header">
                                <div class="stat-icon">üì±</div>
                            </div>
                            <div class="stat-value" id="activeDevices">0</div>
                            <div class="stat-label">Active Devices</div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 30px;">
                        <h3 style="color: #333; margin-bottom: 20px; font-size: 18px;">Export Reports</h3>
                        <div style="display: flex; gap: 15px;">
                            <button class="btn-secondary" onclick="exportReport('users')">
                                üìä Export Users Report
                            </button>
                            <button class="btn-secondary" onclick="exportReport('anime')">
                                üé¨ Export Anime Report
                            </button>
                            <button class="btn-secondary" onclick="exportReport('revenue')">
                                üí∞ Export Revenue Report
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Backup Tab -->
            <div id="backupTab" class="tab-content" style="display: none;">
                <div class="form-container">
                    <h2 class="section-title">Backup & Restore</h2>
                    <p class="section-subtitle">Manage your data backups and restore points</p>
                    
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-header">
                                <div class="stat-icon">üíæ</div>
                            </div>
                            <div class="stat-value" id="lastBackup">Never</div>
                            <div class="stat-label">Last Backup</div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-header">
                                <div class="stat-icon">üì¶</div>
                            </div>
                            <div class="stat-value" id="backupSize">0 MB</div>
                            <div class="stat-label">Backup Size</div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-header">
                                <div class="stat-icon">üîÑ</div>
                            </div>
                            <div class="stat-value" id="autoBackup">On</div>
                            <div class="stat-label">Auto Backup</div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 30px;">
                        <h3 style="color: #333; margin-bottom: 20px; font-size: 18px;">Backup Actions</h3>
                        <div style="display: flex; gap: 15px;">
                            <button class="btn" onclick="createBackup()">
                                üíæ Create Backup Now
                            </button>
                            <button class="btn-secondary" onclick="restoreBackup()">
                                üîÑ Restore Backup
                            </button>
                            <button class="btn-secondary" onclick="downloadBackup()">
                                ‚¨áÔ∏è Download Backup
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Anime Modal -->
    <div class="modal" id="editModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Edit Anime</h2>
                <span class="close-modal" onclick="closeModal()">√ó</span>
            </div>
            <div id="editFormContent">
                <!-- Edit form will be loaded here -->
            </div>
        </div>
    </div>

    <!-- View User Modal -->
    <div class="modal" id="viewUserModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>User Details</h2>
                <span class="close-modal" onclick="closeUserModal()">√ó</span>
            </div>
            <div id="userDetailsContent">
                <!-- User details will be loaded here -->
            </div>
        </div>
    </div>

    <!-- File Upload Script -->
    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAaKOFvJv-7dWDYruOMDgL0nKovFfQvmII",
            authDomain: "fooddelivery-b1f9b.firebaseapp.com",
            databaseURL: "https://fooddelivery-b1f9b-default-rtdb.firebaseio.com",
            projectId: "fooddelivery-b1f9b",
            storageBucket: "fooddelivery-b1f9b.firebasestorage.app",
            messagingSenderId: "403304113348",
            appId: "1:403304113348:web:726235578f8b59e9ddd591"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();
        const storage = firebase.storage();

        // Global variables
        let currentAdmin = null;
        let currentAnimeId = null;
        let seasonsData = {};
        let selectedSeason = 1;
        let selectedEpisode = 1;

        // Toggle password visibility
        function togglePassword() {
            const passwordInput = document.getElementById('adminPassword');
            const toggleBtn = document.querySelector('.toggle-password');
            
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                toggleBtn.textContent = 'üëÅÔ∏è‚Äçüó®Ô∏è';
            } else {
                passwordInput.type = 'password';
                toggleBtn.textContent = 'üëÅÔ∏è';
            }
        }

        // Admin Login with specified credentials
        function adminLogin() {
            const email = document.getElementById('adminEmail').value;
            const password = document.getElementById('adminPassword').value;
            
            // Show loading
            document.getElementById('loginText').style.display = 'none';
            document.getElementById('loginLoading').style.display = 'inline-block';
            
            // Check credentials
            if (email === 'rudradevmanhar820@gmail.com' && password === 'rudra@#_/071989') {
                auth.signInWithEmailAndPassword(email, password)
                    .then((userCredential) => {
                        currentAdmin = userCredential.user;
                        showAdminPanel();
                    })
                    .catch((error) => {
                        // If user doesn't exist, create admin account
                        if (error.code === 'auth/user-not-found') {
                            auth.createUserWithEmailAndPassword(email, password)
                                .then((userCredential) => {
                                    currentAdmin = userCredential.user;
                                    
                                    // Save admin data to database
                                    database.ref('admins/' + currentAdmin.uid).set({
                                        email: email,
                                        name: 'Rudra Dev',
                                        role: 'super_admin',
                                        createdAt: new Date().toISOString(),
                                        permissions: {
                                            manageAnime: true,
                                            manageUsers: true,
                                            manageSettings: true,
                                            viewReports: true
                                        }
                                    }).then(() => {
                                        showAdminPanel();
                                    });
                                })
                                .catch((error) => {
                                    hideLoading();
                                    alert('Error creating admin account: ' + error.message);
                                });
                        } else {
                            hideLoading();
                            alert('Login error: ' + error.message);
                        }
                    });
            } else {
                hideLoading();
                alert('Invalid admin credentials! Please use:\nEmail: rudradevmanhar820@gmail.com\nPassword: rudra@#_/071989');
            }
        }

        function hideLoading() {
            document.getElementById('loginText').style.display = 'inline';
            document.getElementById('loginLoading').style.display = 'none';
        }

        function showAdminPanel() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('adminPanel').style.display = 'flex';
            
            // Load admin data
            loadAdminData();
            loadDashboard();
        }

        function loadAdminData() {
            if (currentAdmin) {
                database.ref('admins/' + currentAdmin.uid).once('value')
                    .then((snapshot) => {
                        const adminData = snapshot.val();
                        if (adminData) {
                            document.getElementById('adminName').textContent = adminData.name || 'Admin';
                            document.getElementById('adminEmailDisplay').textContent = currentAdmin.email;
                        }
                    });
            }
        }

        // Switch tabs
        function switchTab(tab) {
            // Hide all tabs
            document.getElementById('dashboardTab').style.display = 'none';
            document.getElementById('uploadAnimeTab').style.display = 'none';
            document.getElementById('manageAnimeTab').style.display = 'none';
            document.getElementById('manageUsersTab').style.display = 'none';
            document.getElementById('appSettingsTab').style.display = 'none';
            document.getElementById('reportsTab').style.display = 'none';
            document.getElementById('backupTab').style.display = 'none';
            
            // Remove active class from all menu items
            document.querySelectorAll('.menu-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Update page title
            const titles = {
                'dashboard': 'Dashboard Overview',
                'uploadAnime': 'Upload Anime',
                'manageAnime': 'Manage Anime',
                'manageUsers': 'Manage Users',
                'appSettings': 'App Settings',
                'reports': 'Reports & Analytics',
                'backup': 'Backup & Restore'
            };
            
            const subtitles = {
                'dashboard': 'Welcome back, Rudra! Here\'s what\'s happening with your app.',
                'uploadAnime': 'Add new anime content to your streaming platform',
                'manageAnime': 'Edit or delete anime content from your library',
                'manageUsers': 'View, block, or unblock users on your platform',
                'appSettings': 'Configure your anime streaming platform settings',
                'reports': 'Detailed insights about your platform performance',
                'backup': 'Manage your data backups and restore points'
            };
            
            document.getElementById('pageTitle').textContent = titles[tab];
            document.getElementById('pageSubtitle').textContent = subtitles[tab];
            
            // Show selected tab and activate menu item
            if (tab === 'dashboard') {
                document.getElementById('dashboardTab').style.display = 'block';
                document.querySelectorAll('.menu-item')[0].classList.add('active');
                loadDashboard();
            } else if (tab === 'uploadAnime') {
                document.getElementById('uploadAnimeTab').style.display = 'block';
                document.querySelectorAll('.menu-item')[1].classList.add('active');
                resetAnimeForm();
            } else if (tab === 'manageAnime') {
                document.getElementById('manageAnimeTab').style.display = 'block';
                document.querySelectorAll('.menu-item')[2].classList.add('active');
                loadAnimeTable();
            } else if (tab === 'manageUsers') {
                document.getElementById('manageUsersTab').style.display = 'block';
                document.querySelectorAll('.menu-item')[3].classList.add('active');
                loadUsersTable();
            } else if (tab === 'appSettings') {
                document.getElementById('appSettingsTab').style.display = 'block';
                document.querySelectorAll('.menu-item')[4].classList.add('active');
                loadSettings();
            } else if (tab === 'reports') {
                document.getElementById('reportsTab').style.display = 'block';
                document.querySelectorAll('.menu-item')[5].classList.add('active');
                loadReports();
            } else if (tab === 'backup') {
                document.getElementById('backupTab').style.display = 'block';
                document.querySelectorAll('.menu-item')[6].classList.add('active');
                loadBackupInfo();
            }
        }

        // Switch anime form tabs
        function switchAnimeTab(tab) {
            document.querySelectorAll('.anime-tab-content').forEach(content => {
                content.style.display = 'none';
            });
            
            document.querySelectorAll('.tab').forEach(t => {
                t.classList.remove('active');
            });
            
            if (tab === 'basic') {
                document.getElementById('basicInfoTab').style.display = 'block';
                document.querySelectorAll('.tab')[0].classList.add('active');
            } else if (tab === 'seasons') {
                document.getElementById('seasonsTab').style.display = 'block';
                document.querySelectorAll('.tab')[1].classList.add('active');
                generateSeasons();
            } else if (tab === 'media') {
                document.getElementById('mediaTab').style.display = 'block';
                document.querySelectorAll('.tab')[2].classList.add('active');
            }
        }

        // Load dashboard stats
        function loadDashboard() {
            // Load total users
            database.ref('users').once('value')
                .then((snapshot) => {
                    const totalUsers = snapshot.numChildren();
                    document.getElementById('totalUsers').textContent = totalUsers;
                    document.getElementById('usersBadge').textContent = totalUsers;
                    
                    // Calculate active users
                    const today = new Date().toISOString().split('T')[0];
                    let activeCount = 0;
                    snapshot.forEach((child) => {
                        const user = child.val();
                        if (user.lastActive && user.lastActive.includes(today)) {
                            activeCount++;
                        }
                    });
                    document.getElementById('activeUsers').textContent = activeCount;
                });
            
            // Load total anime
            database.ref('anime').once('value')
                .then((snapshot) => {
                    const totalAnime = snapshot.numChildren();
                    document.getElementById('totalAnime').textContent = totalAnime;
                    document.getElementById('animeBadge').textContent = totalAnime;
                    
                    // Calculate total views
                    let totalViews = 0;
                    let dailyViews = 0;
                    const today = new Date().toISOString().split('T')[0];
                    
                    snapshot.forEach((child) => {
                        const anime = child.val();
                        if (anime.views) {
                            totalViews += anime.views;
                        }
                        if (anime.dailyViews && anime.dailyViews[today]) {
                            dailyViews += anime.dailyViews[today];
                        }
                    });
                    
                    document.getElementById('totalViews').textContent = totalViews.toLocaleString();
                    document.getElementById('dashboardBadge').textContent = Math.floor(totalViews / 1000) + 'k';
                });
        }

        // Generate seasons form
        function generateSeasons() {
            const totalSeasons = parseInt(document.getElementById('totalSeasons').value) || 1;
            const seasonsContainer = document.getElementById('seasonsContainer');
            seasonsContainer.innerHTML = '';
            
            seasonsData = {};
            
            for (let i = 1; i <= totalSeasons; i++) {
                const seasonDiv = document.createElement('div');
                seasonDiv.className = 'season-episode-container';
                seasonDiv.innerHTML = `
                    <div class="season-header">
                        <h3>Season ${i}</h3>
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <div>
                                <label style="display: block; margin-bottom: 5px; color: #666; font-size: 14px;">Episodes (1-900):</label>
                                <input type="number" class="form-control" 
                                       id="season${i}Episodes" min="1" max="900" value="12" 
                                       style="width: 120px;"
                                       onchange="generateEpisodes(${i})">
                            </div>
                            <button class="add-btn" onclick="addEpisode(${i})">
                                ‚ûï Add Episode
                            </button>
                        </div>
                    </div>
                    <div id="season${i}EpisodesContainer">
                        <!-- Episodes will be generated here -->
                    </div>
                `;
                seasonsContainer.appendChild(seasonDiv);
                
                // Generate episodes for this season
                generateEpisodes(i);
            }
        }

        // Generate episodes for a season
        function generateEpisodes(seasonNum) {
            const episodesCount = parseInt(document.getElementById(`season${seasonNum}Episodes`).value) || 12;
            const container = document.getElementById(`season${seasonNum}EpisodesContainer`);
            container.innerHTML = '';
            
            seasonsData[seasonNum] = seasonsData[seasonNum] || {};
            
            for (let i = 1; i <= episodesCount; i++) {
                addEpisodeItem(seasonNum, i);
            }
        }

        // Add episode item
        function addEpisodeItem(seasonNum, episodeNum) {
            const container = document.getElementById(`season${seasonNum}EpisodesContainer`);
            
            if (!seasonsData[seasonNum]) seasonsData[seasonNum] = {};
            if (!seasonsData[seasonNum][episodeNum]) {
                seasonsData[seasonNum][episodeNum] = {
                    title: '',
                    description: '',
                    videoFile: null,
                    duration: '24:00'
                };
            }
            
            const episodeDiv = document.createElement('div');
            episodeDiv.className = 'episode-item';
            episodeDiv.id = `season${seasonNum}Episode${episodeNum}`;
            episodeDiv.innerHTML = `
                <div class="episode-header">
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <strong style="color: #333;">Episode ${episodeNum}</strong>
                        <span style="font-size: 12px; color: #666; background: #f0f0f0; padding: 3px 8px; border-radius: 10px;">S${seasonNum}E${episodeNum}</span>
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <input type="file" id="season${seasonNum}Episode${episodeNum}Video" 
                               accept="video/*" style="display: none;" 
                               onchange="handleVideoUpload(${seasonNum}, ${episodeNum}, this)">
                        <button class="action-btn btn-edit" onclick="document.getElementById('season${seasonNum}Episode${episodeNum}Video').click()">
                            üìπ Upload Video
                        </button>
                        <button class="remove-btn" onclick="removeEpisode(${seasonNum}, ${episodeNum})">üóëÔ∏è</button>
                    </div>
                </div>
                <div style="margin-top: 15px;">
                    <div class="form-row">
                        <div class="form-group" style="flex: 1;">
                            <input type="text" class="form-control" 
                                   placeholder="Episode title" 
                                   onchange="updateEpisodeData(${seasonNum}, ${episodeNum}, 'title', this.value)">
                        </div>
                        <div class="form-group" style="width: 150px;">
                            <input type="text" class="form-control" 
                                   placeholder="Duration (MM:SS)" 
                                   value="24:00"
                                   onchange="updateEpisodeData(${seasonNum}, ${episodeNum}, 'duration', this.value)">
                        </div>
                    </div>
                    <textarea class="form-control" style="margin-top: 10px;" 
                              placeholder="Episode description"
                              onchange="updateEpisodeData(${seasonNum}, ${episodeNum}, 'description', this.value)"></textarea>
                    <div id="season${seasonNum}Episode${episodeNum}Preview" style="margin-top: 10px;"></div>
                </div>
            `;
            container.appendChild(episodeDiv);
        }

        // Add episode
        function addEpisode(seasonNum) {
            const episodesCount = parseInt(document.getElementById(`season${seasonNum}Episodes`).value) || 12;
            const newEpisodeNum = episodesCount + 1;
            
            if (newEpisodeNum <= 900) {
                document.getElementById(`season${seasonNum}Episodes`).value = newEpisodeNum;
                addEpisodeItem(seasonNum, newEpisodeNum);
            } else {
                alert('Maximum 900 episodes per season allowed!');
            }
        }

        // Remove episode
        function removeEpisode(seasonNum, episodeNum) {
            if (confirm(`Are you sure you want to remove Episode ${episodeNum} from Season ${seasonNum}?`)) {
                const episodeDiv = document.getElementById(`season${seasonNum}Episode${episodeNum}`);
                if (episodeDiv) {
                    episodeDiv.remove();
                    delete seasonsData[seasonNum][episodeNum];
                    
                    // Update episode count
                    const currentEpisodes = Object.keys(seasonsData[seasonNum] || {}).length;
                    document.getElementById(`season${seasonNum}Episodes`).value = currentEpisodes;
                }
            }
        }

        // Handle video upload
        function handleVideoUpload(seasonNum, episodeNum, fileInput) {
            const file = fileInput.files[0];
            if (file) {
                seasonsData[seasonNum][episodeNum].videoFile = file;
                const previewDiv = document.getElementById(`season${seasonNum}Episode${episodeNum}Preview`);
                previewDiv.innerHTML = `
                    <div style="background: #e8f4ff; padding: 12px; border-radius: 8px; border: 2px dashed #3498db;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="font-weight: 600; color: #2c3e50;">${file.name}</div>
                                <div style="font-size: 12px; color: #7f8c8d; margin-top: 3px;">
                                    ${(file.size / (1024 * 1024)).toFixed(2)} MB ‚Ä¢ ${file.type}
                                </div>
                            </div>
                            <div style="color: #27ae60; font-weight: 600;">‚úì Ready</div>
                        </div>
                    </div>
                `;
            }
        }

        // Update episode data
        function updateEpisodeData(seasonNum, episodeNum, field, value) {
            if (!seasonsData[seasonNum]) seasonsData[seasonNum] = {};
            if (!seasonsData[seasonNum][episodeNum]) seasonsData[seasonNum][episodeNum] = {};
            seasonsData[seasonNum][episodeNum][field] = value;
        }

        // Handle file upload previews
        document.getElementById('thumbnailInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file && file.size <= 5 * 1024 * 1024) { // 5MB limit
                const preview = document.getElementById('thumbnailPreview');
                const reader = new FileReader();
                reader.onload = function(e) {
                    preview.innerHTML = `<img src="${e.target.result}" class="preview-image">`;
                };
                reader.readAsDataURL(file);
            } else {
                alert('File size must be less than 5MB!');
                this.value = '';
            }
        });

        document.getElementById('bannerInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file && file.size <= 10 * 1024 * 1024) { // 10MB limit
                const preview = document.getElementById('bannerPreview');
                const reader = new FileReader();
                reader.onload = function(e) {
                    preview.innerHTML = `<img src="${e.target.result}" class="preview-image">`;
                };
                reader.readAsDataURL(file);
            } else {
                alert('File size must be less than 10MB!');
                this.value = '';
            }
        });

        document.getElementById('logoInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file && file.size <= 2 * 1024 * 1024) { // 2MB limit
                const preview = document.getElementById('logoPreview');
                const reader = new FileReader();
                reader.onload = function(e) {
                    preview.innerHTML = `<img src="${e.target.result}" class="preview-image">`;
                };
                reader.readAsDataURL(file);
            } else {
                alert('File size must be less than 2MB!');
                this.value = '';
            }
        });

        // Upload anime
        async function uploadAnime() {
            const title = document.getElementById('animeTitle').value;
            const category = document.getElementById('animeCategory').value;
            const description = document.getElementById('animeDescription').value;
            const status = document.getElementById('animeStatus').value;
            const releaseYear = document.getElementById('releaseYear').value;
            const rating = document.getElementById('animeRating').value;
            const studio = document.getElementById('animeStudio').value;
            const isSimulcast = document.getElementById('isSimulcast').checked;
            const isDubAvailable = document.getElementById('isDubAvailable').checked;
            const isFeatured = document.getElementById('isFeatured').checked;
            
            // Validation
            if (!title || !category || !description) {
                alert('Please fill in all required fields (Title, Category, Description)!');
                return;
            }
            
            const thumbnailFile = document.getElementById('thumbnailInput').files[0];
            const bannerFile = document.getElementById('bannerInput').files[0];
            
            if (!thumbnailFile || !bannerFile) {
                alert('Please upload both thumbnail and banner images!');
                return;
            }
            
            // Show loading
            const uploadBtn = document.getElementById('uploadAnimeBtn');
            const uploadText = uploadBtn.querySelector('span:first-child');
            const uploadLoading = document.getElementById('uploadLoading');
            
            uploadText.style.display = 'none';
            uploadLoading.style.display = 'inline-block';
            uploadBtn.disabled = true;
            
            try {
                // Create anime ID
                const animeId = 'anime_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                
                // Upload thumbnail
                const thumbnailRef = storage.ref('anime/' + animeId + '/thumbnail.jpg');
                const thumbnailUpload = await thumbnailRef.put(thumbnailFile);
                const thumbnailUrl = await thumbnailUpload.ref.getDownloadURL();
                
                // Upload banner
                const bannerRef = storage.ref('anime/' + animeId + '/banner.jpg');
                const bannerUpload = await bannerRef.put(bannerFile);
                const bannerUrl = await bannerUpload.ref.getDownloadURL();
                
                // Prepare anime data
                const animeData = {
                    title: title,
                    category: category,
                    description: description,
                    status: status,
                    releaseYear: parseInt(releaseYear) || 2024,
                    rating: parseFloat(rating) || 8.5,
                    studio: studio,
                    isSimulcast: isSimulcast,
                    isDubAvailable: isDubAvailable,
                    isFeatured: isFeatured,
                    thumbnail: thumbnailUrl,
                    banner: bannerUrl,
                    views: 0,
                    dailyViews: {},
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString(),
                    seasons: {}
                };
                
                // Upload episodes
                let totalEpisodes = 0;
                
                for (const seasonNum in seasonsData) {
                    animeData.seasons[seasonNum] = {
                        episodes: {}
                    };
                    
                    for (const episodeNum in seasonsData[seasonNum]) {
                        const episode = seasonsData[seasonNum][episodeNum];
                        
                        if (episode.videoFile) {
                            // Upload video
                            const videoRef = storage.ref(`anime/${animeId}/season${seasonNum}/episode${episodeNum}.mp4`);
                            const videoUpload = await videoRef.put(episode.videoFile);
                            const videoUrl = await videoUpload.ref.getDownloadURL();
                            
                            // Add episode data
                            animeData.seasons[seasonNum].episodes[episodeNum] = {
                                title: episode.title || `Episode ${episodeNum}`,
                                description: episode.description || '',
                                videoUrl: videoUrl,
                                duration: episode.duration || '24:00',
                                views: 0
                            };
                            
                            totalEpisodes++;
                        }
                    }
                }
                
                // Add episode count
                animeData.totalEpisodes = totalEpisodes;
                animeData.totalSeasons = Object.keys(seasonsData).length;
                
                // Save to database
                await database.ref('anime/' + animeId).set(animeData);
                
                // Show success message
                alert(`‚úÖ Anime uploaded successfully!\n\nTitle: ${title}\nSeasons: ${animeData.totalSeasons}\nEpisodes: ${totalEpisodes}\n\nAnime ID: ${animeId}`);
                
                // Reset form
                resetAnimeForm();
                
                // Switch to manage anime tab
                switchTab('manageAnime');
                
            } catch (error) {
                alert('‚ùå Error uploading anime: ' + error.message);
                console.error('Upload error:', error);
            } finally {
                // Hide loading
                uploadText.style.display = 'inline';
                uploadLoading.style.display = 'none';
                uploadBtn.disabled = false;
            }
        }

        // Reset anime form
        function resetAnimeForm() {
            document.getElementById('animeTitle').value = '';
            document.getElementById('animeCategory').value = 'action';
            document.getElementById('animeDescription').value = '';
            document.getElementById('animeStatus').value = 'ongoing';
            document.getElementById('releaseYear').value = '2024';
            document.getElementById('animeRating').value = '8.5';
            document.getElementById('animeStudio').value = '';
            document.getElementById('totalSeasons').value = '1';
            document.getElementById('isSimulcast').checked = false;
            document.getElementById('isDubAvailable').checked = false;
            document.getElementById('isFeatured').checked = false;
            document.getElementById('thumbnailPreview').innerHTML = '';
            document.getElementById('bannerPreview').innerHTML = '';
            document.getElementById('thumbnailInput').value = '';
            document.getElementById('bannerInput').value = '';
            seasonsData = {};
            generateSeasons();
            switchAnimeTab('basic');
        }

        // Load anime table
        function loadAnimeTable() {
            const searchTerm = document.getElementById('searchAnime').value.toLowerCase();
            const filterCategory = document.getElementById('filterCategory').value;
            
            database.ref('anime').once('value')
                .then((snapshot) => {
                    const tableBody = document.getElementById('animeTableBody');
                    tableBody.innerHTML = '';
                    
                    let hasResults = false;
                    
                    snapshot.forEach((childSnapshot) => {
                        const anime = childSnapshot.val();
                        const animeId = childSnapshot.key;
                        
                        // Apply filters
                        if (filterCategory && anime.category !== filterCategory) {
                            return;
                        }
                        
                        if (searchTerm && !anime.title.toLowerCase().includes(searchTerm)) {
                            return;
                        }
                        
                        hasResults = true;
                        
                        // Count episodes
                        let totalEpisodes = 0;
                        if (anime.seasons) {
                            Object.values(anime.seasons).forEach(season => {
                                if (season.episodes) {
                                    totalEpisodes += Object.keys(season.episodes).length;
                                }
                            });
                        }
                        
                        const row = `
                            <tr>
                                <td style="font-family: monospace; color: #666;">${animeId.substring(0, 8)}...</td>
                                <td>
                                    <img src="${anime.thumbnail || 'https://via.placeholder.com/50x70'}" 
                                         style="width: 50px; height: 70px; object-fit: cover; border-radius: 6px;">
                                </td>
                                <td>
                                    <div style="font-weight: 600; color: #333;">${anime.title}</div>
                                    <div style="font-size: 12px; color: #666;">${anime.studio || 'Unknown Studio'}</div>
                                </td>
                                <td>
                                    <span style="background: #e8f4ff; color: #3498db; padding: 4px 10px; border-radius: 12px; font-size: 12px; font-weight: 600;">
                                        ${anime.category}
                                    </span>
                                </td>
                                <td>${anime.seasons ? Object.keys(anime.seasons).length : 1}</td>
                                <td>${totalEpisodes}</td>
                                <td style="font-weight: 600;">${(anime.views || 0).toLocaleString()}</td>
                                <td>
                                    <span class="status-badge ${anime.status === 'ongoing' ? 'status-active' : 
                                                               anime.status === 'completed' ? 'status-inactive' : 
                                                               'status-pending'}">
                                        ${anime.status}
                                    </span>
                                </td>
                                <td>
                                    <div class="action-buttons">
                                        <button class="action-btn btn-view" onclick="viewAnime('${animeId}')">
                                            üëÅÔ∏è View
                                        </button>
                                        <button class="action-btn btn-edit" onclick="editAnime('${animeId}')">
                                            ‚úèÔ∏è Edit
                                        </button>
                                        <button class="action-btn btn-delete" onclick="deleteAnime('${animeId}')">
                                            üóëÔ∏è Delete
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        `;
                        tableBody.innerHTML += row;
                    });
                    
                    document.getElementById('animeTableEmpty').style.display = hasResults ? 'none' : 'block';
                })
                .catch((error) => {
                    console.error('Error loading anime:', error);
                    document.getElementById('animeTableEmpty').textContent = 'Error loading anime. Please try again.';
                });
        }

        // View anime details
        function viewAnime(animeId) {
            database.ref('anime/' + animeId).once('value')
                .then((snapshot) => {
                    const anime = snapshot.val();
                    if (!anime) return;
                    
                    let episodesList = '';
                    if (anime.seasons) {
                        Object.entries(anime.seasons).forEach(([seasonNum, season]) => {
                            episodesList += `<h4 style="margin-top: 15px; color: #333;">Season ${seasonNum}</h4>`;
                            if (season.episodes) {
                                Object.entries(season.episodes).forEach(([episodeNum, episode]) => {
                                    episodesList += `
                                        <div style="background: #f8f9fa; padding: 10px; margin: 5px 0; border-radius: 6px;">
                                            <div style="font-weight: 600;">Episode ${episodeNum}: ${episode.title}</div>
                                            <div style="font-size: 12px; color: #666;">${episode.duration || '24:00'} ‚Ä¢ ${episode.views || 0} views</div>
                                        </div>
                                    `;
                                });
                            }
                        });
                    }
                    
                    const details = `
                        <div style="text-align: center; margin-bottom: 20px;">
                            <img src="${anime.banner || anime.thumbnail}" 
                                 style="width: 100%; max-height: 200px; object-fit: cover; border-radius: 10px; margin-bottom: 15px;">
                            <h3 style="color: #333; margin-bottom: 10px;">${anime.title}</h3>
                            <div style="display: flex; justify-content: center; gap: 10px; margin-bottom: 15px;">
                                <span style="background: #667eea; color: white; padding: 4px 12px; border-radius: 15px; font-size: 12px;">
                                    ${anime.category}
                                </span>
                                <span style="background: #2ecc71; color: white; padding: 4px 12px; border-radius: 15px; font-size: 12px;">
                                    ‚≠ê ${anime.rating || 'N/A'}
                                </span>
                                <span style="background: #3498db; color: white; padding: 4px 12px; border-radius: 15px; font-size: 12px;">
                                    üëÅÔ∏è ${(anime.views || 0).toLocaleString()}
                                </span>
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <h4 style="color: #333; margin-bottom: 10px;">Description</h4>
                            <p style="color: #666; line-height: 1.6;">${anime.description || 'No description available.'}</p>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 20px;">
                            <div>
                                <div style="font-size: 12px; color: #666; margin-bottom: 5px;">Status</div>
                                <div style="font-weight: 600; color: #333;">${anime.status || 'Unknown'}</div>
                            </div>
                            <div>
                                <div style="font-size: 12px; color: #666; margin-bottom: 5px;">Release Year</div>
                                <div style="font-weight: 600; color: #333;">${anime.releaseYear || 'N/A'}</div>
                            </div>
                            <div>
                                <div style="font-size: 12px; color: #666; margin-bottom: 5px;">Studio</div>
                                <div style="font-weight: 600; color: #333;">${anime.studio || 'Unknown'}</div>
                            </div>
                            <div>
                                <div style="font-size: 12px; color: #666; margin-bottom: 5px;">Total Episodes</div>
                                <div style="font-weight: 600; color: #333;">${anime.totalEpisodes || 0}</div>
                            </div>
                        </div>
                        
                        <div>
                            <h4 style="color: #333; margin-bottom: 15px;">Episodes</h4>
                            ${episodesList || '<p style="color: #666; text-align: center;">No episodes uploaded yet.</p>'}
                        </div>
                        
                        <div style="margin-top: 25px; text-align: center;">
                            <button class="btn" onclick="editAnime('${animeId}')" style="padding: 12px 30px;">
                                ‚úèÔ∏è Edit This Anime
                            </button>
                        </div>
                    `;
                    
                    document.getElementById('editFormContent').innerHTML = details;
                    document.getElementById('editModal').style.display = 'block';
                    document.querySelector('.modal-header h2').textContent = 'Anime Details';
                });
        }

        // Edit anime
        function editAnime(animeId) {
            currentAnimeId = animeId;
            
            database.ref('anime/' + animeId).once('value')
                .then((snapshot) => {
                    const anime = snapshot.val();
                    
                    const editForm = `
                        <div class="form-group">
                            <label>Anime Title</label>
                            <input type="text" id="editTitle" class="form-control" value="${anime.title}">
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label>Category</label>
                                <select id="editCategory" class="form-control">
                                    <option value="action" ${anime.category === 'action' ? 'selected' : ''}>Action</option>
                                    <option value="adventure" ${anime.category === 'adventure' ? 'selected' : ''}>Adventure</option>
                                    <option value="comedy" ${anime.category === 'comedy' ? 'selected' : ''}>Comedy</option>
                                    <option value="drama" ${anime.category === 'drama' ? 'selected' : ''}>Drama</option>
                                    <option value="fantasy" ${anime.category === 'fantasy' ? 'selected' : ''}>Fantasy</option>
                                    <option value="horror" ${anime.category === 'horror' ? 'selected' : ''}>Horror</option>
                                    <option value="romance" ${anime.category === 'romance' ? 'selected' : ''}>Romance</option>
                                    <option value="sci-fi" ${anime.category === 'sci-fi' ? 'selected' : ''}>Sci-Fi</option>
                                    <option value="shounen" ${anime.category === 'shounen' ? 'selected' : ''}>Shounen</option>
                                    <option value="shoujo" ${anime.category === 'shoujo' ? 'selected' : ''}>Shoujo</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label>Status</label>
                                <select id="editStatus" class="form-control">
                                    <option value="ongoing" ${anime.status === 'ongoing' ? 'selected' : ''}>Ongoing</option>
                                    <option value="completed" ${anime.status === 'completed' ? 'selected' : ''}>Completed</option>
                                    <option value="upcoming" ${anime.status === 'upcoming' ? 'selected' : ''}>Upcoming</option>
                                    <option value="hiatus" ${anime.status === 'hiatus' ? 'selected' : ''}>Hiatus</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>Description</label>
                            <textarea id="editDescription" class="form-control" rows="4">${anime.description}</textarea>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label>Views</label>
                                <input type="number" id="editViews" class="form-control" value="${anime.views || 0}">
                            </div>
                            
                            <div class="form-group">
                                <label>Rating (1-10)</label>
                                <input type="number" id="editRating" class="form-control" 
                                       min="1" max="10" step="0.1" value="${anime.rating || 8.5}">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>Add New Episode</label>
                            <div class="form-row">
                                <div class="form-group">
                                    <input type="number" id="newEpisodeSeason" class="form-control" 
                                           placeholder="Season" min="1" value="1">
                                </div>
                                <div class="form-group">
                                    <input type="number" id="newEpisodeNumber" class="form-control" 
                                           placeholder="Episode" min="1">
                                </div>
                            </div>
                            <div style="margin-top: 10px;">
                                <input type="file" id="newEpisodeVideo" accept="video/*" style="display: none;" 
                                       onchange="uploadNewEpisode()">
                                <button class="btn-secondary" onclick="document.getElementById('newEpisodeVideo').click()">
                                    üìπ Select Video File
                                </button>
                            </div>
                        </div>
                        
                        <div class="form-actions">
                            <button class="btn-secondary" onclick="closeModal()">
                                Cancel
                            </button>
                            <button class="btn" onclick="saveAnimeEdit()">
                                üíæ Save Changes
                            </button>
                        </div>
                    `;
                    
                    document.getElementById('editFormContent').innerHTML = editForm;
                    document.getElementById('editModal').style.display = 'block';
                    document.querySelector('.modal-header h2').textContent = 'Edit Anime';
                });
        }

        // Upload new episode
        async function uploadNewEpisode() {
            const season = document.getElementById('newEpisodeSeason').value;
            const episode = document.getElementById('newEpisodeNumber').value;
            const videoFile = document.getElementById('newEpisodeVideo').files[0];
            
            if (!season || !episode || !videoFile) {
                alert('Please fill in all fields and select a video file!');
                return;
            }
            
            if (!currentAnimeId) {
                alert('No anime selected!');
                return;
            }
            
            try {
                // Upload video
                const videoRef = storage.ref(`anime/${currentAnimeId}/season${season}/episode${episode}.mp4`);
                const videoUpload = await videoRef.put(videoFile);
                const videoUrl = await videoUpload.ref.getDownloadURL();
                
                // Add to database
                await database.ref(`anime/${currentAnimeId}/seasons/${season}/episodes/${episode}`).set({
                    title: `Episode ${episode}`,
                    description: 'New episode added via admin',
                    videoUrl: videoUrl,
                    duration: '24:00',
                    views: 0,
                    addedAt: new Date().toISOString()
                });
                
                // Update total episodes count
                const animeRef = database.ref('anime/' + currentAnimeId);
                const snapshot = await animeRef.once('value');
                const anime = snapshot.val();
                const currentEpisodes = anime.totalEpisodes || 0;
                
                await animeRef.update({
                    totalEpisodes: currentEpisodes + 1,
                    updatedAt: new Date().toISOString()
                });
                
                alert('‚úÖ Episode added successfully!');
                closeModal();
                loadAnimeTable();
                
            } catch (error) {
                alert('‚ùå Error adding episode: ' + error.message);
            }
        }

        // Save anime edit
        async function saveAnimeEdit() {
            const updates = {
                title: document.getElementById('editTitle').value,
                category: document.getElementById('editCategory').value,
                description: document.getElementById('editDescription').value,
                status: document.getElementById('editStatus').value,
                views: parseInt(document.getElementById('editViews').value) || 0,
                rating: parseFloat(document.getElementById('editRating').value) || 8.5,
                updatedAt: new Date().toISOString()
            };
            
            try {
                await database.ref('anime/' + currentAnimeId).update(updates);
                alert('‚úÖ Anime updated successfully!');
                closeModal();
                loadAnimeTable();
            } catch (error) {
                alert('‚ùå Error updating anime: ' + error.message);
            }
        }

        // Delete anime
        function deleteAnime(animeId) {
            if (confirm('‚ö†Ô∏è Are you sure you want to delete this anime?\n\nThis action cannot be undone and will remove all episodes, thumbnails, and banners associated with this anime.')) {
                database.ref('anime/' + animeId).remove()
                    .then(() => {
                        alert('‚úÖ Anime deleted successfully!');
                        loadAnimeTable();
                    })
                    .catch((error) => {
                        alert('‚ùå Error deleting anime: ' + error.message);
                    });
            }
        }

        // Load users table
        function loadUsersTable() {
            const searchTerm = document.getElementById('searchUsers').value.toLowerCase();
            const filterStatus = document.getElementById('filterStatus').value;
            
            database.ref('users').once('value')
                .then((snapshot) => {
                    const tableBody = document.getElementById('usersTableBody');
                    tableBody.innerHTML = '';
                    
                    let hasResults = false;
                    
                    snapshot.forEach((childSnapshot) => {
                        const user = childSnapshot.val();
                        const userId = childSnapshot.key;
                        
                        // Apply filters
                        if (filterStatus === 'active' && user.isBlocked) {
                            return;
                        }
                        if (filterStatus === 'blocked' && !user.isBlocked) {
                            return;
                        }
                        
                        if (searchTerm && !user.name.toLowerCase().includes(searchTerm) && 
                            !user.email.toLowerCase().includes(searchTerm)) {
                            return;
                        }
                        
                        hasResults = true;
                        
                        // Count watched anime
                        let watchedCount = 0;
                        if (user.watchHistory) {
                            watchedCount = Object.keys(user.watchHistory).length;
                        }
                        
                        const row = `
                            <tr>
                                <td style="font-family: monospace; color: #666;">${userId.substring(0, 8)}...</td>
                                <td>
                                    <img src="${user.profilePic || `https://ui-avatars.com/api/?name=${encodeURIComponent(user.name)}&background=667eea&color=fff&size=40`}" 
                                         style="width: 40px; height: 40px; border-radius: 50%; object-fit: cover;">
                                </td>
                                <td>
                                    <div style="font-weight: 600; color: #333;">${user.name}</div>
                                    <div style="font-size: 12px; color: #666;">Member since ${new Date(user.createdAt).toLocaleDateString()}</div>
                                </td>
                                <td>${user.email}</td>
                                <td>${new Date(user.createdAt).toLocaleDateString()}</td>
                                <td>
                                    <div style="font-weight: 600; color: #333;">${watchedCount}</div>
                                    <div style="font-size: 12px; color: #666;">episodes</div>
                                </td>
                                <td>
                                    <span class="status-badge ${user.isBlocked ? 'status-inactive' : 'status-active'}">
                                        ${user.isBlocked ? 'Blocked' : 'Active'}
                                    </span>
                                </td>
                                <td>
                                    <div class="action-buttons">
                                        <button class="action-btn btn-view" onclick="viewUser('${userId}')">
                                            üëÅÔ∏è View
                                        </button>
                                        ${user.isBlocked ? 
                                            `<button class="action-btn btn-edit" onclick="toggleBlockUser('${userId}', false)">
                                                üîì Unblock
                                            </button>` : 
                                            `<button class="action-btn btn-block" onclick="toggleBlockUser('${userId}', true)">
                                                üîí Block
                                            </button>`
                                        }
                                    </div>
                                </td>
                            </tr>
                        `;
                        tableBody.innerHTML += row;
                    });
                    
                    document.getElementById('usersTableEmpty').style.display = hasResults ? 'none' : 'block';
                })
                .catch((error) => {
                    console.error('Error loading users:', error);
                    document.getElementById('usersTableEmpty').textContent = 'Error loading users. Please try again.';
                });
        }

        // View user details
        function viewUser(userId) {
            database.ref('users/' + userId).once('value')
                .then((snapshot) => {
                    const user = snapshot.val();
                    if (!user) return;
                    
                    // Count watch history
                    let watchedCount = 0;
                    let watchTime = 0;
                    let recentWatches = [];
                    
                    if (user.watchHistory) {
                        watchedCount = Object.keys(user.watchHistory).length;
                        watchTime = Math.round(watchedCount * 24 / 60); // Assuming 24 min per episode
                        
                        // Get recent watches (last 5)
                        const watches = Object.values(user.watchHistory)
                            .sort((a, b) => new Date(b.watchedAt) - new Date(a.watchedAt))
                            .slice(0, 5);
                        
                        recentWatches = watches.map(watch => `
                            <div style="background: #f8f9fa; padding: 10px; margin: 5px 0; border-radius: 6px;">
                                <div style="font-weight: 600;">${watch.animeTitle}</div>
                                <div style="font-size: 12px; color: #666;">
                                    S${watch.season}E${watch.episode} ‚Ä¢ ${new Date(watch.watchedAt).toLocaleString()}
                                </div>
                            </div>
                        `).join('');
                    }
                    
                    const details = `
                        <div style="text-align: center; margin-bottom: 20px;">
                            <img src="${user.profilePic || `https://ui-avatars.com/api/?name=${encodeURIComponent(user.name)}&background=667eea&color=fff&size=100`}" 
                                 style="width: 100px; height: 100px; border-radius: 50%; object-fit: cover; margin-bottom: 15px; border: 3px solid #667eea;">
                            <h3 style="color: #333; margin-bottom: 5px;">${user.name}</h3>
                            <p style="color: #666; margin-bottom: 15px;">${user.email}</p>
                            <div style="display: flex; justify-content: center; gap: 10px;">
                                <span style="background: ${user.isBlocked ? '#ff4757' : '#2ecc71'}; color: white; padding: 4px 12px; border-radius: 15px; font-size: 12px;">
                                    ${user.isBlocked ? 'üîí Blocked' : '‚úÖ Active'}
                                </span>
                                <span style="background: #3498db; color: white; padding: 4px 12px; border-radius: 15px; font-size: 12px;">
                                    üë§ Member
                                </span>
                            </div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 20px;">
                            <div style="text-align: center;">
                                <div style="font-size: 24px; font-weight: 700; color: #667eea;">${watchedCount}</div>
                                <div style="font-size: 12px; color: #666;">Episodes Watched</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 24px; font-weight: 700; color: #2ecc71;">${watchTime}</div>
                                <div style="font-size: 12px; color: #666;">Watch Hours</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 24px; font-weight: 700; color: #ff9f43;">${user.myList ? user.myList.length : 0}</div>
                                <div style="font-size: 12px; color: #666;">In My List</div>
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <h4 style="color: #333; margin-bottom: 10px;">Account Info</h4>
                            <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                    <span style="color: #666;">Joined:</span>
                                    <span style="font-weight: 600; color: #333;">${new Date(user.createdAt).toLocaleDateString()}</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                    <span style="color: #666;">Last Active:</span>
                                    <span style="font-weight: 600; color: #333;">${user.lastActive ? new Date(user.lastActive).toLocaleDateString() : 'Never'}</span>
                                </div>
                                <div style="display: flex; justify-content: space-between;">
                                    <span style="color: #666;">Account Type:</span>
                                    <span style="font-weight: 600; color: #333;">Free User</span>
                                </div>
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <h4 style="color: #333; margin-bottom: 10px;">Recent Watch History</h4>
                            ${recentWatches || '<p style="color: #666; text-align: center;">No watch history yet.</p>'}
                        </div>
                        
                        <div style="margin-top: 25px; text-align: center;">
                            ${user.isBlocked ? 
                                `<button class="btn" onclick="toggleBlockUser('${userId}', false); closeUserModal();" style="padding: 12px 30px; background: #2ecc71;">
                                    üîì Unblock User
                                </button>` : 
                                `<button class="btn" onclick="toggleBlockUser('${userId}', true); closeUserModal();" style="padding: 12px 30px; background: #ff4757;">
                                    üîí Block User
                                </button>`
                            }
                        </div>
                    `;
                    
                    document.getElementById('userDetailsContent').innerHTML = details;
                    document.getElementById('viewUserModal').style.display = 'block';
                });
        }

        // Toggle block user
        function toggleBlockUser(userId, block) {
            const action = block ? 'block' : 'unblock';
            const confirmMsg = block ? 
                'Are you sure you want to block this user? They will not be able to access the app.' :
                'Are you sure you want to unblock this user? They will regain access to the app.';
            
            if (confirm(confirmMsg)) {
                database.ref('users/' + userId).update({
                    isBlocked: block,
                    updatedAt: new Date().toISOString()
                })
                .then(() => {
                    alert(`‚úÖ User ${action}ed successfully!`);
                    loadUsersTable();
                })
                .catch((error) => {
                    alert(`‚ùå Error ${action}ing user: ` + error.message);
                });
            }
        }

        // Close modals
        function closeModal() {
            document.getElementById('editModal').style.display = 'none';
        }

        function closeUserModal() {
            document.getElementById('viewUserModal').style.display = 'none';
        }

        // Load settings
        function loadSettings() {
            database.ref('settings').once('value')
                .then((snapshot) => {
                    const settings = snapshot.val() || {};
                    
                    document.getElementById('appName').value = settings.appName || 'AnimeStream Pro';
                    document.getElementById('admobId').value = settings.admobId || 'ca-pub-8675548946096450';
                    document.getElementById('adsPerEpisode').value = settings.adsPerEpisode || 3;
                    document.getElementById('welcomeMessage').value = settings.welcomeMessage || 'Welcome to AnimeStream Pro!';
                    document.getElementById('contactEmail').value = settings.contactEmail || 'support@animestream.com';
                    document.getElementById('privacyPolicy').value = settings.privacyPolicy || 'https://animestream.com/privacy';
                    document.getElementById('termsOfService').value = settings.termsOfService || 'https://animestream.com/terms';
                    
                    if (settings.logoUrl) {
                        document.getElementById('logoPreview').innerHTML = 
                            `<img src="${settings.logoUrl}" class="preview-image">`;
                    }
                });
        }

        // Save settings
        async function saveSettings() {
            const settings = {
                appName: document.getElementById('appName').value,
                admobId: document.getElementById('admobId').value,
                adsPerEpisode: parseInt(document.getElementById('adsPerEpisode').value) || 3,
                welcomeMessage: document.getElementById('welcomeMessage').value,
                contactEmail: document.getElementById('contactEmail').value,
                privacyPolicy: document.getElementById('privacyPolicy').value,
                termsOfService: document.getElementById('termsOfService').value,
                updatedAt: new Date().toISOString()
            };
            
            try {
                // Handle logo upload if new one is selected
                const logoFile = document.getElementById('logoInput').files[0];
                if (logoFile) {
                    const logoRef = storage.ref('settings/logo.jpg');
                    const logoUpload = await logoRef.put(logoFile);
                    settings.logoUrl = await logoUpload.ref.getDownloadURL();
                }
                
                // Save to database
                await database.ref('settings').set(settings);
                alert('‚úÖ Settings saved successfully!');
                
            } catch (error) {
                alert('‚ùå Error saving settings: ' + error.message);
            }
        }

        // Load reports
        function loadReports() {
            // Calculate daily views
            const today = new Date().toISOString().split('T')[0];
            let dailyViews = 0;
            let estimatedRevenue = 0;
            
            database.ref('anime').once('value')
                .then((snapshot) => {
                    snapshot.forEach((child) => {
                        const anime = child.val();
                        if (anime.dailyViews && anime.dailyViews[today]) {
                            dailyViews += anime.dailyViews[today];
                        }
                    });
                    
                    // Estimate revenue (assuming $1 per 1000 views)
                    estimatedRevenue = (dailyViews / 1000).toFixed(2);
                    
                    document.getElementById('dailyViews').textContent = dailyViews.toLocaleString();
                    document.getElementById('estimatedRevenue').textContent = '$' + estimatedRevenue;
                    document.getElementById('avgWatchTime').textContent = '2.4h';
                    document.getElementById('activeDevices').textContent = '1.2k';
                });
        }

        // Export reports
        function exportReport(type) {
            alert(`üìä ${type.charAt(0).toUpperCase() + type.slice(1)} report exported successfully!\n\nThe report will be downloaded shortly.`);
            // In a real implementation, this would generate and download a CSV/PDF file
        }

        // Backup functions
        function loadBackupInfo() {
            const today = new Date().toLocaleDateString();
            document.getElementById('lastBackup').textContent = today;
            document.getElementById('backupSize').textContent = '45.2 MB';
            document.getElementById('autoBackup').textContent = 'Enabled';
        }

        function createBackup() {
            if (confirm('Create a new backup of all app data?\n\nThis may take a few moments.')) {
                alert('‚úÖ Backup created successfully!\n\nBackup ID: backup_' + Date.now());
            }
        }

        function restoreBackup() {
            alert('This feature requires server-side implementation.\n\nIn a production app, this would allow you to restore from a previous backup.');
        }

        function downloadBackup() {
            alert('Backup download started.\n\nIn a production app, this would download a complete backup file.');
        }

        // Logout
        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                auth.signOut()
                    .then(() => {
                        document.getElementById('adminPanel').style.display = 'none';
                        document.getElementById('loginScreen').style.display = 'flex';
                        
                        // Reset form
                        document.getElementById('adminPassword').value = 'rudra@#_/071989';
                    })
                    .catch((error) => {
                        alert('Logout error: ' + error.message);
                    });
            }
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Check if admin is already logged in
            auth.onAuthStateChanged((user) => {
                if (user) {
                    currentAdmin = user;
                    if (user.email === 'rudradevmanhar820@gmail.com') {
                        showAdminPanel();
                    } else {
                        // If logged in with different email, logout
                        auth.signOut();
                    }
                }
            });
            
            // Pre-fill credentials
            document.getElementById('adminEmail').value = 'rudradevmanhar820@gmail.com';
            document.getElementById('adminPassword').value = 'rudra@#_/071989';
            
            // Initialize anime form
            generateSeasons();
        });
    </script>
</body>
</html>