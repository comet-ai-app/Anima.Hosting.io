<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - AnimeFlix</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary: #ff375f;
            --secondary: #2a2a3c;
            --dark: #1a1a2e;
            --light: #f8f9fa;
            --gray: #6c757d;
            --success: #51cf66;
            --warning: #ff922b;
            --danger: #ff6b6b;
        }

        body {
            background: var(--dark);
            color: var(--light);
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Admin Login */
        .admin-login {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, var(--dark), #0f3460);
        }

        .admin-login-box {
            background: rgba(42, 42, 60, 0.95);
            padding: 40px;
            border-radius: 20px;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        .admin-login-box h1 {
            text-align: center;
            color: var(--primary);
            margin-bottom: 30px;
            font-size: 2rem;
        }

        /* Admin Dashboard */
        .admin-header {
            background: var(--secondary);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
        }

        .admin-nav {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 30px;
            background: var(--secondary);
            padding: 20px;
            border-radius: 15px;
        }

        .nav-btn {
            padding: 12px 25px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 10px;
            color: var(--light);
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .nav-btn:hover {
            background: rgba(255, 55, 95, 0.2);
            transform: translateY(-2px);
        }

        .nav-btn.active {
            background: var(--primary);
            color: white;
        }

        .dashboard-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--secondary);
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            transition: all 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }

        .stat-icon {
            font-size: 2.5rem;
            color: var(--primary);
            margin-bottom: 15px;
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .stat-label {
            color: var(--gray);
            font-size: 1.1rem;
        }

        .content-section {
            display: none;
            background: var(--secondary);
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
        }

        .content-section.active {
            display: block;
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section-title {
            font-size: 1.8rem;
            margin-bottom: 25px;
            color: var(--light);
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }

        /* Forms */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--light);
            font-weight: 500;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            color: var(--light);
            font-size: 1rem;
            transition: all 0.3s;
        }

        .form-group textarea {
            min-height: 120px;
            resize: vertical;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 10px rgba(255, 55, 95, 0.2);
        }

        .btn {
            padding: 15px 30px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }

        .btn:hover {
            background: #ff1e4f;
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(255, 55, 95, 0.4);
        }

        .btn-success {
            background: var(--success);
        }

        .btn-warning {
            background: var(--warning);
        }

        .btn-danger {
            background: var(--danger);
        }

        .btn-secondary {
            background: transparent;
            border: 2px solid var(--primary);
        }

        /* Tables */
        .table-container {
            overflow-x: auto;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 20px;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px;
        }

        .data-table th {
            background: rgba(255, 55, 95, 0.2);
            padding: 15px;
            text-align: left;
            color: var(--primary);
            font-weight: 600;
        }

        .data-table td {
            padding: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .data-table tr:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .action-buttons {
            display: flex;
            gap: 10px;
        }

        .action-btn {
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .edit-btn {
            background: var(--warning);
            color: white;
        }

        .delete-btn {
            background: var(--danger);
            color: white;
        }

        .view-btn {
            background: var(--success);
            color: white;
        }

        .upload-area {
            border: 3px dashed rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 20px;
        }

        .upload-area:hover {
            border-color: var(--primary);
            background: rgba(255, 55, 95, 0.05);
        }

        .upload-area i {
            font-size: 3rem;
            color: var(--primary);
            margin-bottom: 15px;
        }

        .upload-area p {
            color: var(--gray);
            margin-bottom: 10px;
        }

        .preview-image {
            width: 200px;
            height: 300px;
            object-fit: cover;
            border-radius: 10px;
            margin: 10px 0;
        }

        .video-preview {
            width: 100%;
            max-width: 400px;
            border-radius: 10px;
            margin: 10px 0;
        }

        /* Settings */
        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
        }

        .settings-card {
            background: rgba(255, 255, 255, 0.05);
            padding: 25px;
            border-radius: 15px;
        }

        .logo-preview {
            width: 200px;
            height: 80px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
        }

        .status-badge {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .online {
            background: rgba(81, 207, 102, 0.2);
            color: var(--success);
        }

        .offline {
            background: rgba(255, 107, 107, 0.2);
            color: var(--danger);
        }

        /* Episode Management */
        .season-episode-management {
            margin-top: 30px;
        }

        .season-card, .episode-card {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
        }

        .episode-card {
            margin-left: 30px;
        }

        .season-header, .episode-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--secondary);
            border-radius: 20px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 1.8rem;
            color: var(--light);
        }

        .close-modal {
            background: none;
            border: none;
            color: var(--gray);
            font-size: 1.5rem;
            cursor: pointer;
        }

        /* Messages */
        .message {
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: none;
        }

        .message.success {
            background: rgba(81, 207, 102, 0.2);
            color: var(--success);
            border: 1px solid var(--success);
            display: block;
        }

        .message.error {
            background: rgba(255, 107, 107, 0.2);
            color: var(--danger);
            border: 1px solid var(--danger);
            display: block;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .admin-nav {
                flex-direction: column;
            }
            
            .nav-btn {
                width: 100%;
            }
            
            .dashboard-stats {
                grid-template-columns: 1fr;
            }
            
            .action-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <!-- Admin Login -->
    <div class="admin-login" id="adminLogin">
        <div class="admin-login-box">
            <h1><i class="fas fa-shield-alt"></i> Admin Panel</h1>
            <div class="form-group">
                <label>Email</label>
                <input type="email" id="adminEmail" placeholder="admin@example.com">
            </div>
            <div class="form-group">
                <label>Password</label>
                <input type="password" id="adminPassword" placeholder="••••••••">
            </div>
            <div class="message error" id="loginError"></div>
            <button class="btn" onclick="adminLogin()" style="width: 100%;">
                <i class="fas fa-sign-in-alt"></i> Login as Admin
            </button>
        </div>
    </div>

    <!-- Admin Dashboard -->
    <div class="admin-dashboard" id="adminDashboard" style="display: none;">
        <div class="container">
            <!-- Header -->
            <div class="admin-header">
                <h1 style="color: var(--primary);">
                    <i class="fas fa-cogs"></i> AnimeFlix Admin Panel
                </h1>
                <div>
                    <span id="adminName" style="margin-right: 20px;"></span>
                    <button class="btn btn-danger" onclick="adminLogout()">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                </div>
            </div>

            <!-- Navigation -->
            <div class="admin-nav">
                <button class="nav-btn active" onclick="showSection('dashboard')">
                    <i class="fas fa-tachometer-alt"></i> Dashboard
                </button>
                <button class="nav-btn" onclick="showSection('anime')">
                    <i class="fas fa-film"></i> Manage Anime
                </button>
                <button class="nav-btn" onclick="showSection('users')">
                    <i class="fas fa-users"></i> User Management
                </button>
                <button class="nav-btn" onclick="showSection('settings')">
                    <i class="fas fa-cog"></i> App Settings
                </button>
                <button class="nav-btn" onclick="showSection('reports')">
                    <i class="fas fa-chart-bar"></i> Reports
                </button>
            </div>

            <!-- Dashboard Section -->
            <div class="content-section active" id="dashboardSection">
                <h2 class="section-title">Dashboard Overview</h2>
                
                <div class="dashboard-stats">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-number" id="totalUsers">0</div>
                        <div class="stat-label">Total Users</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-film"></i>
                        </div>
                        <div class="stat-number" id="totalAnime">0</div>
                        <div class="stat-label">Total Anime</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-play-circle"></i>
                        </div>
                        <div class="stat-number" id="totalEpisodes">0</div>
                        <div class="stat-label">Total Episodes</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-eye"></i>
                        </div>
                        <div class="stat-number" id="totalViews">0</div>
                        <div class="stat-label">Total Views</div>
                    </div>
                </div>

                <div class="table-container">
                    <h3 style="margin-bottom: 20px;">Recent Activity</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Time</th>
                                <th>User</th>
                                <th>Activity</th>
                                <th>Details</th>
                            </tr>
                        </thead>
                        <tbody id="activityLog">
                            <!-- Activity log will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Manage Anime Section -->
            <div class="content-section" id="animeSection">
                <h2 class="section-title">Anime Management</h2>
                
                <div class="message success" id="animeSuccess"></div>
                <div class="message error" id="animeError"></div>
                
                <div class="form-grid">
                    <div class="form-group">
                        <label>Anime Title *</label>
                        <input type="text" id="animeTitle" placeholder="Enter anime title">
                    </div>
                    
                    <div class="form-group">
                        <label>Category *</label>
                        <select id="animeCategory">
                            <option value="">Select Category</option>
                            <option value="Action">Action</option>
                            <option value="Adventure">Adventure</option>
                            <option value="Comedy">Comedy</option>
                            <option value="Drama">Drama</option>
                            <option value="Fantasy">Fantasy</option>
                            <option value="Horror">Horror</option>
                            <option value="Romance">Romance</option>
                            <option value="Sci-Fi">Sci-Fi</option>
                            <option value="Slice of Life">Slice of Life</option>
                            <option value="Sports">Sports</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Description *</label>
                    <textarea id="animeDescription" placeholder="Enter anime description"></textarea>
                </div>
                
                <div class="form-grid">
                    <div class="form-group">
                        <label>Rating</label>
                        <input type="text" id="animeRating" placeholder="e.g., 8.5">
                    </div>
                    
                    <div class="form-group">
                        <label>Release Year</label>
                        <input type="number" id="animeYear" min="1900" max="2024" placeholder="2024">
                    </div>
                </div>
                
                <!-- Thumbnail Upload -->
                <div class="upload-area" onclick="document.getElementById('thumbnailInput').click()">
                    <i class="fas fa-image"></i>
                    <p>Click to upload thumbnail (200x280 recommended)</p>
                    <p style="font-size: 0.9rem;">Max size: 2MB</p>
                    <input type="file" id="thumbnailInput" accept="image/*" style="display: none;" onchange="previewThumbnail(event)">
                </div>
                <img id="thumbnailPreview" class="preview-image" style="display: none;">
                
                <!-- Banner Upload -->
                <div class="upload-area" onclick="document.getElementById('bannerInput').click()">
                    <i class="fas fa-image"></i>
                    <p>Click to upload banner (1200x400 recommended)</p>
                    <p style="font-size: 0.9rem;">Max size: 3MB</p>
                    <input type="file" id="bannerInput" accept="image/*" style="display: none;" onchange="previewBanner(event)">
                </div>
                <img id="bannerPreview" style="width: 100%; max-height: 200px; object-fit: cover; border-radius: 10px; display: none;">
                
                <!-- Season Management -->
                <div class="season-episode-management">
                    <h3 style="margin: 30px 0 20px;">Seasons & Episodes</h3>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Number of Seasons (1-100)</label>
                            <input type="number" id="seasonCount" min="1" max="100" value="1">
                        </div>
                        
                        <div class="form-group">
                            <label>Episodes per Season (1-900)</label>
                            <input type="number" id="episodesPerSeason" min="1" max="900" value="12">
                        </div>
                    </div>
                    
                    <div id="seasonsContainer">
                        <!-- Seasons will be dynamically added here -->
                    </div>
                    
                    <button class="btn btn-secondary" onclick="addSeason()">
                        <i class="fas fa-plus"></i> Add Season
                    </button>
                </div>
                
                <div style="margin-top: 30px;">
                    <button class="btn btn-success" onclick="saveAnime()">
                        <i class="fas fa-save"></i> Save Anime
                    </button>
                    <button class="btn btn-secondary" onclick="clearAnimeForm()">
                        <i class="fas fa-times"></i> Clear Form
                    </button>
                </div>
                
                <!-- Anime List -->
                <h3 style="margin: 40px 0 20px;">Existing Anime</h3>
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Thumbnail</th>
                                <th>Title</th>
                                <th>Category</th>
                                <th>Seasons</th>
                                <th>Rating</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="animeList">
                            <!-- Anime list will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- User Management Section -->
            <div class="content-section" id="usersSection">
                <h2 class="section-title">User Management</h2>
                
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>User ID</th>
                                <th>Username</th>
                                <th>Email</th>
                                <th>Joined</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="usersList">
                            <!-- Users list will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Settings Section -->
            <div class="content-section" id="settingsSection">
                <h2 class="section-title">App Settings</h2>
                
                <div class="settings-grid">
                    <div class="settings-card">
                        <h3 style="margin-bottom: 20px;">App Appearance</h3>
                        
                        <div class="form-group">
                            <label>App Name</label>
                            <input type="text" id="appName" value="AnimeFlix">
                        </div>
                        
                        <div class="form-group">
                            <label>App Logo</label>
                            <div class="upload-area" onclick="document.getElementById('logoInput').click()">
                                <i class="fas fa-image"></i>
                                <p>Upload New Logo</p>
                            </div>
                            <input type="file" id="logoInput" accept="image/*" style="display: none;">
                        </div>
                        
                        <div class="logo-preview" id="logoPreview">
                            AnimeFlix
                        </div>
                        
                        <div class="form-group">
                            <label>Primary Color</label>
                            <input type="color" id="primaryColor" value="#ff375f">
                        </div>
                        
                        <button class="btn" onclick="saveAppSettings()">
                            <i class="fas fa-save"></i> Save Appearance
                        </button>
                    </div>
                    
                    <div class="settings-card">
                        <h3 style="margin-bottom: 20px;">AdMob Settings</h3>
                        
                        <div class="form-group">
                            <label>AdMob Publisher ID</label>
                            <input type="text" id="admobId" value="ca-pub-8675548946096450" disabled>
                        </div>
                        
                        <div class="form-group">
                            <label>Ads per Episode</label>
                            <input type="number" id="adsPerEpisode" min="1" max="10" value="3">
                        </div>
                        
                        <div class="form-group">
                            <label>Ad Frequency</label>
                            <select id="adFrequency">
                                <option value="every_episode">Every Episode</option>
                                <option value="every_3_episodes">Every 3 Episodes</option>
                                <option value="every_5_episodes">Every 5 Episodes</option>
                            </select>
                        </div>
                        
                        <div class="status-badge online">
                            <i class="fas fa-circle"></i> AdMob Active
                        </div>
                    </div>
                    
                    <div class="settings-card">
                        <h3 style="margin-bottom: 20px;">System Status</h3>
                        
                        <div style="margin-bottom: 20px;">
                            <p><strong>Database:</strong> <span class="status-badge online">Connected</span></p>
                            <p><strong>Storage:</strong> <span class="status-badge online">Active</span></p>
                            <p><strong>Authentication:</strong> <span class="status-badge online">Running</span></p>
                        </div>
                        
                        <div class="form-group">
                            <label>Maintenance Mode</label>
                            <select id="maintenanceMode">
                                <option value="false">Disabled</option>
                                <option value="true">Enabled</option>
                            </select>
                        </div>
                        
                        <button class="btn btn-danger" onclick="clearAllData()">
                            <i class="fas fa-trash"></i> Clear All Data
                        </button>
                    </div>
                </div>
            </div>

            <!-- Reports Section -->
            <div class="content-section" id="reportsSection">
                <h2 class="section-title">Reports & Analytics</h2>
                
                <div class="dashboard-stats">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="stat-number" id="dailyViews">0</div>
                        <div class="stat-label">Daily Views</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-user-plus"></i>
                        </div>
                        <div class="stat-number" id="newUsers">0</div>
                        <div class="stat-label">New Users (Today)</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-money-bill-wave"></i>
                        </div>
                        <div class="stat-number" id="revenue">$0.00</div>
                        <div class="stat-label">Estimated Revenue</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stat-number" id="avgWatchTime">0m</div>
                        <div class="stat-label">Avg. Watch Time</div>
                    </div>
                </div>
                
                <div class="table-container" style="margin-top: 30px;">
                    <h3 style="margin-bottom: 20px;">Top Anime</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Rank</th>
                                <th>Anime</th>
                                <th>Views</th>
                                <th>Watch Time</th>
                                <th>Completion Rate</th>
                            </tr>
                        </thead>
                        <tbody id="topAnime">
                            <!-- Top anime will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Anime Modal -->
    <div class="modal" id="editAnimeModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Edit Anime</h3>
                <button class="close-modal" onclick="closeEditModal()">&times;</button>
            </div>
            <div id="editAnimeForm">
                <!-- Edit form will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Firebase Scripts -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-storage.js"></script>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAaKOFvJv-7dWDYruOMDgL0nKovFfQvmII",
            authDomain: "fooddelivery-b1f9b.firebaseapp.com",
            databaseURL: "https://fooddelivery-b1f9b-default-rtdb.firebaseio.com",
            projectId: "fooddelivery-b1f9b",
            storageBucket: "fooddelivery-b1f9b.firebasestorage.app",
            messagingSenderId: "403304113348",
            appId: "1:403304113348:web:726235578f8b59e9ddd591"
        };

        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();
        const storage = firebase.storage();

        let currentAdmin = null;
        let currentEditingAnime = null;
        let seasons = [];

        // Admin Login
        function adminLogin() {
            const email = document.getElementById('adminEmail').value;
            const password = document.getElementById('adminPassword').value;
            const errorDiv = document.getElementById('loginError');

            errorDiv.textContent = '';
            errorDiv.className = 'message error';

            if (!email || !password) {
                errorDiv.textContent = 'Please enter email and password';
                errorDiv.style.display = 'block';
                return;
            }

            auth.signInWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    const user = userCredential.user;
                    
                    // Check if user is admin
                    return database.ref('users/' + user.uid).once('value');
                })
                .then((snapshot) => {
                    const userData = snapshot.val();
                    
                    if (userData && userData.isAdmin === true) {
                        currentAdmin = auth.currentUser;
                        showAdminDashboard();
                        loadDashboardStats();
                        loadAnimeList();
                        loadUsersList();
                    } else {
                        auth.signOut();
                        throw new Error('Access denied. Admin privileges required.');
                    }
                })
                .catch((error) => {
                    errorDiv.textContent = error.message;
                    errorDiv.style.display = 'block';
                });
        }

        function showAdminDashboard() {
            document.getElementById('adminLogin').style.display = 'none';
            document.getElementById('adminDashboard').style.display = 'block';
            document.getElementById('adminName').textContent = currentAdmin.email;
        }

        function adminLogout() {
            auth.signOut().then(() => {
                currentAdmin = null;
                document.getElementById('adminDashboard').style.display = 'none';
                document.getElementById('adminLogin').style.display = 'flex';
                
                // Clear forms
                document.getElementById('adminEmail').value = '';
                document.getElementById('adminPassword').value = '';
            });
        }

        // Section Navigation
        function showSection(section) {
            // Hide all sections
            document.querySelectorAll('.content-section').forEach(s => {
                s.classList.remove('active');
            });
            
            // Remove active class from all nav buttons
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected section
            if (section === 'dashboard') {
                document.getElementById('dashboardSection').classList.add('active');
                document.querySelector('.nav-btn:nth-child(1)').classList.add('active');
                loadDashboardStats();
            } else if (section === 'anime') {
                document.getElementById('animeSection').classList.add('active');
                document.querySelector('.nav-btn:nth-child(2)').classList.add('active');
                loadAnimeList();
            } else if (section === 'users') {
                document.getElementById('usersSection').classList.add('active');
                document.querySelector('.nav-btn:nth-child(3)').classList.add('active');
                loadUsersList();
            } else if (section === 'settings') {
                document.getElementById('settingsSection').classList.add('active');
                document.querySelector('.nav-btn:nth-child(4)').classList.add('active');
            } else if (section === 'reports') {
                document.getElementById('reportsSection').classList.add('active');
                document.querySelector('.nav-btn:nth-child(5)').classList.add('active');
                loadReports();
            }
        }

        // Dashboard Stats
        function loadDashboardStats() {
            // Total Users
            database.ref('users').once('value')
                .then((snapshot) => {
                    document.getElementById('totalUsers').textContent = snapshot.numChildren();
                });

            // Total Anime
            database.ref('anime').once('value')
                .then((snapshot) => {
                    document.getElementById('totalAnime').textContent = snapshot.numChildren();
                    
                    // Calculate total episodes
                    let totalEpisodes = 0;
                    snapshot.forEach((animeSnapshot) => {
                        const anime = animeSnapshot.val();
                        if (anime.seasons) {
                            Object.values(anime.seasons).forEach(season => {
                                if (season.episodes) {
                                    totalEpisodes += Object.keys(season.episodes).length;
                                }
                            });
                        }
                    });
                    document.getElementById('totalEpisodes').textContent = totalEpisodes;
                });

            // Total Views
            database.ref('views').once('value')
                .then((snapshot) => {
                    document.getElementById('totalViews').textContent = snapshot.numChildren();
                });

            // Activity Log
            database.ref('activity').limitToLast(10).once('value')
                .then((snapshot) => {
                    const activityLog = document.getElementById('activityLog');
                    activityLog.innerHTML = '';
                    
                    const activities = [];
                    snapshot.forEach((childSnapshot) => {
                        activities.unshift(childSnapshot.val());
                    });
                    
                    activities.forEach(activity => {
                        activityLog.innerHTML += `
                            <tr>
                                <td>${new Date(activity.timestamp).toLocaleString()}</td>
                                <td>${activity.user || 'System'}</td>
                                <td>${activity.action}</td>
                                <td>${activity.details || ''}</td>
                            </tr>
                        `;
                    });
                });
        }

        // Anime Management
        function previewThumbnail(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const preview = document.getElementById('thumbnailPreview');
                    preview.src = e.target.result;
                    preview.style.display = 'block';
                };
                reader.readAsDataURL(file);
            }
        }

        function previewBanner(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const preview = document.getElementById('bannerPreview');
                    preview.src = e.target.result;
                    preview.style.display = 'block';
                };
                reader.readAsDataURL(file);
            }
        }

        function addSeason() {
            const seasonCount = parseInt(document.getElementById('seasonCount').value) || 1;
            const episodesPerSeason = parseInt(document.getElementById('episodesPerSeason').value) || 12;
            
            seasons = [];
            const seasonsContainer = document.getElementById('seasonsContainer');
            seasonsContainer.innerHTML = '';
            
            for (let i = 1; i <= seasonCount; i++) {
                seasons.push({
                    number: i,
                    title: `Season ${i}`,
                    episodes: episodesPerSeason
                });
                
                seasonsContainer.innerHTML += `
                    <div class="season-card">
                        <div class="season-header">
                            <h4>Season ${i}</h4>
                            <button class="btn btn-secondary" onclick="manageSeason(${i})">
                                <i class="fas fa-edit"></i> Manage
                            </button>
                        </div>
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Season Title</label>
                                <input type="text" id="seasonTitle${i}" value="Season ${i}" 
                                       onchange="updateSeason(${i}, 'title', this.value)">
                            </div>
                            <div class="form-group">
                                <label>Number of Episodes (1-900)</label>
                                <input type="number" id="seasonEpisodes${i}" value="${episodesPerSeason}" min="1" max="900"
                                       onchange="updateSeason(${i}, 'episodes', this.value)">
                            </div>
                        </div>
                    </div>
                `;
            }
        }

        function updateSeason(seasonNumber, field, value) {
            const season = seasons.find(s => s.number === seasonNumber);
            if (season) {
                season[field] = value;
            }
        }

        function manageSeason(seasonNumber) {
            alert(`Managing season ${seasonNumber}. You can upload videos for each episode in this season.`);
        }

        async function saveAnime() {
            const title = document.getElementById('animeTitle').value;
            const description = document.getElementById('animeDescription').value;
            const category = document.getElementById('animeCategory').value;
            const rating = document.getElementById('animeRating').value;
            const year = document.getElementById('animeYear').value;
            
            const successDiv = document.getElementById('animeSuccess');
            const errorDiv = document.getElementById('animeError');
            
            successDiv.style.display = 'none';
            errorDiv.style.display = 'none';

            if (!title || !description || !category) {
                errorDiv.textContent = 'Please fill in all required fields';
                errorDiv.style.display = 'block';
                return;
            }

            const animeData = {
                title: title,
                description: description,
                category: category,
                rating: rating || 'NR',
                year: year || '2024',
                createdAt: Date.now(),
                updatedAt: Date.now(),
                createdBy: currentAdmin.uid
            };

            // Upload thumbnail if selected
            const thumbnailFile = document.getElementById('thumbnailInput').files[0];
            if (thumbnailFile) {
                try {
                    const thumbnailUrl = await uploadFile(thumbnailFile, 'thumbnails/');
                    animeData.thumbnail = thumbnailUrl;
                } catch (error) {
                    errorDiv.textContent = 'Error uploading thumbnail: ' + error.message;
                    errorDiv.style.display = 'block';
                    return;
                }
            }

            // Upload banner if selected
            const bannerFile = document.getElementById('bannerInput').files[0];
            if (bannerFile) {
                try {
                    const bannerUrl = await uploadFile(bannerFile, 'banners/');
                    animeData.banner = bannerUrl;
                } catch (error) {
                    // Continue even if banner upload fails
                    console.error('Banner upload failed:', error);
                }
            }

            // Save anime data
            const animeRef = database.ref('anime').push();
            animeData.id = animeRef.key;
            
            // Add seasons
            if (seasons.length > 0) {
                animeData.seasons = {};
                seasons.forEach(season => {
                    animeData.seasons[`season${season.number}`] = {
                        number: season.number,
                        title: season.title || `Season ${season.number}`,
                        createdAt: Date.now()
                    };
                    
                    // Add episodes placeholder
                    animeData.seasons[`season${season.number}`].episodes = {};
                    for (let i = 1; i <= (season.episodes || 12); i++) {
                        animeData.seasons[`season${season.number}`].episodes[`episode${i}`] = {
                            number: i,
                            title: `Episode ${i}`,
                            description: '',
                            videoUrl: '',
                            thumbnail: '',
                            duration: '24:00',
                            createdAt: Date.now()
                        };
                    }
                });
            }

            animeRef.set(animeData)
                .then(() => {
                    successDiv.textContent = 'Anime saved successfully!';
                    successDiv.style.display = 'block';
                    
                    // Record activity
                    recordActivity('Added new anime', title);
                    
                    // Clear form
                    clearAnimeForm();
                    
                    // Reload anime list
                    loadAnimeList();
                    
                    // Update dashboard stats
                    loadDashboardStats();
                })
                .catch((error) => {
                    errorDiv.textContent = 'Error saving anime: ' + error.message;
                    errorDiv.style.display = 'block';
                });
        }

        function uploadFile(file, path) {
            return new Promise((resolve, reject) => {
                const storageRef = storage.ref(path + Date.now() + '_' + file.name);
                const uploadTask = storageRef.put(file);
                
                uploadTask.on('state_changed',
                    (snapshot) => {
                        // Progress handling
                        const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                        console.log('Upload is ' + progress + '% done');
                    },
                    (error) => {
                        reject(error);
                    },
                    () => {
                        uploadTask.snapshot.ref.getDownloadURL().then((downloadURL) => {
                            resolve(downloadURL);
                        });
                    }
                );
            });
        }

        function clearAnimeForm() {
            document.getElementById('animeTitle').value = '';
            document.getElementById('animeDescription').value = '';
            document.getElementById('animeCategory').value = '';
            document.getElementById('animeRating').value = '';
            document.getElementById('animeYear').value = '';
            document.getElementById('seasonCount').value = '1';
            document.getElementById('episodesPerSeason').value = '12';
            document.getElementById('thumbnailPreview').style.display = 'none';
            document.getElementById('bannerPreview').style.display = 'none';
            document.getElementById('seasonsContainer').innerHTML = '';
            seasons = [];
            
            const successDiv = document.getElementById('animeSuccess');
            const errorDiv = document.getElementById('animeError');
            successDiv.style.display = 'none';
            errorDiv.style.display = 'none';
        }

        function loadAnimeList() {
            database.ref('anime').once('value')
                .then((snapshot) => {
                    const animeList = document.getElementById('animeList');
                    animeList.innerHTML = '';
                    
                    snapshot.forEach((childSnapshot) => {
                        const anime = childSnapshot.val();
                        anime.id = childSnapshot.key;
                        
                        const seasonCount = anime.seasons ? Object.keys(anime.seasons).length : 0;
                        
                        animeList.innerHTML += `
                            <tr>
                                <td>
                                    <img src="${anime.thumbnail || 'https://via.placeholder.com/60x80'}" 
                                         style="width: 60px; height: 80px; object-fit: cover; border-radius: 5px;">
                                </td>
                                <td>${anime.title}</td>
                                <td>${anime.category}</td>
                                <td>${seasonCount}</td>
                                <td>${anime.rating || 'NR'}</td>
                                <td>
                                    <div class="action-buttons">
                                        <button class="action-btn edit-btn" onclick="editAnime('${anime.id}')">
                                            <i class="fas fa-edit"></i> Edit
                                        </button>
                                        <button class="action-btn delete-btn" onclick="deleteAnime('${anime.id}', '${anime.title}')">
                                            <i class="fas fa-trash"></i> Delete
                                        </button>
                                        <button class="action-btn view-btn" onclick="viewAnime('${anime.id}')">
                                            <i class="fas fa-eye"></i> View
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        `;
                    });
                });
        }

        function editAnime(animeId) {
            database.ref('anime/' + animeId).once('value')
                .then((snapshot) => {
                    const anime = snapshot.val();
                    currentEditingAnime = anime;
                    currentEditingAnime.id = animeId;
                    
                    const modal = document.getElementById('editAnimeModal');
                    const form = document.getElementById('editAnimeForm');
                    
                    form.innerHTML = `
                        <div class="form-group">
                            <label>Anime Title</label>
                            <input type="text" id="editAnimeTitle" value="${anime.title}">
                        </div>
                        <div class="form-group">
                            <label>Description</label>
                            <textarea id="editAnimeDescription">${anime.description || ''}</textarea>
                        </div>
                        <div class="form-group">
                            <label>Category</label>
                            <select id="editAnimeCategory">
                                <option value="Action" ${anime.category === 'Action' ? 'selected' : ''}>Action</option>
                                <option value="Adventure" ${anime.category === 'Adventure' ? 'selected' : ''}>Adventure</option>
                                <option value="Comedy" ${anime.category === 'Comedy' ? 'selected' : ''}>Comedy</option>
                                <option value="Drama" ${anime.category === 'Drama' ? 'selected' : ''}>Drama</option>
                                <option value="Fantasy" ${anime.category === 'Fantasy' ? 'selected' : ''}>Fantasy</option>
                                <option value="Horror" ${anime.category === 'Horror' ? 'selected' : ''}>Horror</option>
                                <option value="Romance" ${anime.category === 'Romance' ? 'selected' : ''}>Romance</option>
                                <option value="Sci-Fi" ${anime.category === 'Sci-Fi' ? 'selected' : ''}>Sci-Fi</option>
                            </select>
                        </div>
                        <div style="display: flex; gap: 10px; margin-top: 20px;">
                            <button class="btn btn-success" onclick="updateAnime()">
                                <i class="fas fa-save"></i> Save Changes
                            </button>
                            <button class="btn btn-danger" onclick="deleteAnime('${animeId}', '${anime.title}')">
                                <i class="fas fa-trash"></i> Delete Anime
                            </button>
                        </div>
                    `;
                    
                    modal.classList.add('active');
                });
        }

        function updateAnime() {
            if (!currentEditingAnime) return;
            
            const updates = {
                title: document.getElementById('editAnimeTitle').value,
                description: document.getElementById('editAnimeDescription').value,
                category: document.getElementById('editAnimeCategory').value,
                updatedAt: Date.now()
            };
            
            database.ref('anime/' + currentEditingAnime.id).update(updates)
                .then(() => {
                    alert('Anime updated successfully!');
                    closeEditModal();
                    loadAnimeList();
                    recordActivity('Updated anime', currentEditingAnime.title);
                })
                .catch((error) => {
                    alert('Error updating anime: ' + error.message);
                });
        }

        function deleteAnime(animeId, animeTitle) {
            if (confirm(`Are you sure you want to delete "${animeTitle}"? This action cannot be undone.`)) {
                database.ref('anime/' + animeId).remove()
                    .then(() => {
                        alert('Anime deleted successfully!');
                        loadAnimeList();
                        loadDashboardStats();
                        recordActivity('Deleted anime', animeTitle);
                        
                        if (currentEditingAnime && currentEditingAnime.id === animeId) {
                            closeEditModal();
                        }
                    })
                    .catch((error) => {
                        alert('Error deleting anime: ' + error.message);
                    });
            }
        }

        function viewAnime(animeId) {
            window.open(`index.html?anime=${animeId}`, '_blank');
        }

        function closeEditModal() {
            document.getElementById('editAnimeModal').classList.remove('active');
            currentEditingAnime = null;
        }

        // User Management
        function loadUsersList() {
            database.ref('users').once('value')
                .then((snapshot) => {
                    const usersList = document.getElementById('usersList');
                    usersList.innerHTML = '';
                    
                    snapshot.forEach((childSnapshot) => {
                        const user = childSnapshot.val();
                        user.id = childSnapshot.key;
                        
                        const joinDate = user.createdAt ? new Date(user.createdAt).toLocaleDateString() : 'N/A';
                        const status = user.isBlocked ? 'Blocked' : 'Active';
                        
                        usersList.innerHTML += `
                            <tr>
                                <td>${user.id.substring(0, 8)}...</td>
                                <td>${user.username || 'N/A'}</td>
                                <td>${user.email || 'N/A'}</td>
                                <td>${joinDate}</td>
                                <td>
                                    <span class="status-badge ${user.isBlocked ? 'offline' : 'online'}">
                                        ${status}
                                    </span>
                                </td>
                                <td>
                                    <div class="action-buttons">
                                        <button class="action-btn ${user.isBlocked ? 'btn-success' : 'btn-warning'}" 
                                                onclick="toggleUserBlock('${user.id}', ${!user.isBlocked})">
                                            <i class="fas fa-${user.isBlocked ? 'check' : 'ban'}"></i>
                                            ${user.isBlocked ? 'Unblock' : 'Block'}
                                        </button>
                                        ${user.isAdmin ? '<span style="color: var(--primary);">Admin</span>' : 
                                          `<button class="action-btn btn-success" onclick="makeAdmin('${user.id}')">
                                            <i class="fas fa-shield-alt"></i> Make Admin
                                           </button>`}
                                    </div>
                                </td>
                            </tr>
                        `;
                    });
                });
        }

        function toggleUserBlock(userId, block) {
            database.ref('users/' + userId).update({
                isBlocked: block,
                updatedAt: Date.now()
            })
            .then(() => {
                alert(`User ${block ? 'blocked' : 'unblocked'} successfully!`);
                loadUsersList();
                recordActivity(block ? 'Blocked user' : 'Unblocked user', userId);
            })
            .catch((error) => {
                alert('Error: ' + error.message);
            });
        }

        function makeAdmin(userId) {
            if (confirm('Give this user admin privileges?')) {
                database.ref('users/' + userId).update({
                    isAdmin: true,
                    updatedAt: Date.now()
                })
                .then(() => {
                    alert('User granted admin privileges!');
                    loadUsersList();
                    recordActivity('Made user admin', userId);
                })
                .catch((error) => {
                    alert('Error: ' + error.message);
                });
            }
        }

        // App Settings
        function saveAppSettings() {
            const appName = document.getElementById('appName').value;
            const primaryColor = document.getElementById('primaryColor').value;
            
            database.ref('settings/app').update({
                name: appName,
                primaryColor: primaryColor,
                updatedAt: Date.now(),
                updatedBy: currentAdmin.uid
            })
            .then(() => {
                alert('App settings saved successfully!');
                recordActivity('Updated app settings', '');
            })
            .catch((error) => {
                alert('Error saving settings: ' + error.message);
            });
        }

        function clearAllData() {
            if (confirm('WARNING: This will delete ALL data including users, anime, and settings. This action cannot be undone!')) {
                const password = prompt('Enter admin password to confirm:');
                if (password === 'admin123') { // You should use a more secure method in production
                    database.ref().remove()
                        .then(() => {
                            alert('All data cleared successfully!');
                            location.reload();
                        })
                        .catch((error) => {
                            alert('Error clearing data: ' + error.message);
                        });
                } else {
                    alert('Incorrect password!');
                }
            }
        }

        // Reports
        function loadReports() {
            // Daily Views
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            database.ref('views').orderByChild('timestamp').startAt(today.getTime()).once('value')
                .then((snapshot) => {
                    document.getElementById('dailyViews').textContent = snapshot.numChildren();
                });

            // New Users Today
            database.ref('users').orderByChild('createdAt').startAt(today.getTime()).once('value')
                .then((snapshot) => {
                    document.getElementById('newUsers').textContent = snapshot.numChildren();
                });

            // Estimated Revenue (based on views)
            database.ref('views').once('value')
                .then((snapshot) => {
                    const totalViews = snapshot.numChildren();
                    const estimatedRevenue = (totalViews * 0.01).toFixed(2); // $0.01 per view
                    document.getElementById('revenue').textContent = '$' + estimatedRevenue;
                });

            // Load Top Anime
            database.ref('anime').once('value')
                .then((snapshot) => {
                    const topAnime = document.getElementById('topAnime');
                    topAnime.innerHTML = '';
                    
                    let animeList = [];
                    snapshot.forEach((childSnapshot) => {
                        const anime = childSnapshot.val();
                        anime.id = childSnapshot.key;
                        anime.views = anime.views || Math.floor(Math.random() * 10000); // Sample data
                        animeList.push(anime);
                    });
                    
                    // Sort by views
                    animeList.sort((a, b) => b.views - a.views);
                    
                    animeList.slice(0, 10).forEach((anime, index) => {
                        topAnime.innerHTML += `
                            <tr>
                                <td>${index + 1}</td>
                                <td>${anime.title}</td>
                                <td>${anime.views.toLocaleString()}</td>
                                <td>${Math.floor(anime.views * 24)}m</td>
                                <td>${Math.min(100, Math.floor(Math.random() * 30) + 70)}%</td>
                            </tr>
                        `;
                    });
                });
        }

        // Activity Recording
        function recordActivity(action, details) {
            if (!currentAdmin) return;
            
            const activityData = {
                user: currentAdmin.email,
                action: action,
                details: details,
                timestamp: Date.now()
            };
            
            database.ref('activity').push(activityData);
        }

        // Check if user is already logged in as admin
        auth.onAuthStateChanged((user) => {
            if (user) {
                database.ref('users/' + user.uid).once('value')
                    .then((snapshot) => {
                        const userData = snapshot.val();
                        if (userData && userData.isAdmin === true) {
                            currentAdmin = user;
                            showAdminDashboard();
                            loadDashboardStats();
                            loadAnimeList();
                            loadUsersList();
                        }
                    });
            }
        });

        // Initialize seasons
        addSeason();
    </script>
</body>
</html>